'use strict';

(function (root) {

	function init() {
		$('.gallery__element').first().trigger('click');
	};

	$('.range__slider').each(function () {
		var range = this,
		    minInput = $(range).closest('.range').find('[data-input="min"]'),
		    maxInput = $(range).closest('.range').find('[data-input="max"]');

		function update() {
			var from = $(range).data('from'),
			    to = $(range).data('to');

			$(minInput).val(from);
			$(maxInput).val(to);
		}

		$(range).ionRangeSlider({
			extra_classes: 'range__slider',
			hide_min_max: true,
			hide_from_to: true
		});

		update();
		$(range).on('change', update);
	});

	$('[data-input]').on('change', function () {
		var range = $(this).closest('.range').find('input.range__slider').data("ionRangeSlider"),
		    val = $(this).val(),
		    min = range.options.min,
		    max = range.options.max,
		    from = range.options.from,
		    to = range.options.to,
		    step = range.options.step;

		switch ($(this).data('input')) {
			case 'min':
				if (val <= min) {
					val = min;
				} else if (val >= max) {
					val = max - step;
				} else if (val >= to) {
					val = to - step;
				}

				range.update({
					from: val
				});
				break;
			case 'max':
				if (val >= max) {
					val = max;
				} else if (val <= min) {
					val = min + step;
				} else if (val <= from) {
					val = from + step;
				}

				range.update({
					to: val
				});
				break;
		}

		$(this).val(val);
	});

	function filled(field) {
		var val = $(field).val().trim();

		if (val.length > 0) {
			$(field).closest('.field').addClass('field_filled');
		} else {
			$(field).closest('.field').removeClass('field_filled');
		}
	}

	$('.field input').each(function () {
		filled(this);
	});

	$('.toggle').on('click', function (e) {
		e.stopPropagation();
		var content = $(this).parent().find($('.' + $(this).data('toggle')));
		$(this).toggleClass('toggle_close');
		$(content).stop().slideToggle(300);
	});

	$('.filter__block-content').each(function (i, block) {
		var checks = $(block).find('.checkbox').length;

		if (checks > 5) {
			$(block).addClass('filter__block-content_more');
			$(block).append('<span class="filter__block-more">Показать все</span>');
		}
	});

	$('.filter__block-more').on('click', function () {
		$(this).parent().removeClass('filter__block-content_more');
		$(this).remove();
	});

	$('.drop__item').on('click', function () {
		if (!$(this).hasClass('drop__item_link')) {
			$(this).addClass('drop__item_active').siblings().removeClass('drop__item_active');
		}

		$(this).closest('[data-drop]').removeClass('drop-open');
	});

	$(document).on('click', '[data-drop]', function () {

		var data = $(this).data('drop');

		if (data == 'trigger') {
			$('.drop-open').removeClass('drop-open');
			$(this).parent().closest('[data-drop]').addClass('drop-open');
		} else return;
	});

	$(document).on('click', function (e) {

		var drop = $(e.target).parent().closest('[data-drop]').get(0),
		    tip = $(e.target).parent().closest('.tip').get(0);

		if (!drop) {
			$('.drop-open').removeClass('drop-open');
		}

		if (!tip) {
			$('.tip__hidecontent').hide();
		}
	});

	$('.description__show').on('click', function () {
		$(this).hide();
		$('.description__more').show();
	});

	$('[data-close]').on('click', function () {
		$(this).parent().hide();
		$(this).closest('.card').css('z-index', '');
	});

	$('.tip__name').on('click', function () {
		$('.card').css('z-index', '');
		$('.tip__hidecontent').hide();
		$(this).parent().find('.tip__hidecontent').show();
		$(this).closest('.card').css('z-index', '2');
	});

	var dataSliders = {
		feautures: {
			items: 6,
			nav: true
		},
		gallery: {
			items: 1,
			nav: true,
			dots: true,
			mouseDrag: false,
			responsive: {
				961: {
					items: 4,
					dots: false
				}
			}
		}
	};

	$('[data-slider]').each(function (i, slider) {
		var data = $(this).data('slider');

		$(slider).owlCarousel(dataSliders[data]);
	});

	// Gallery
	$('.gallery__element').on('click', function () {

		if ($(this).hasClass('gallery__element_video')) {
			var video = $(this).find('video').clone();

			$('.modal_zoom .modal__content').html(video);

			$('.modal_zoom').iziModal('open');
		} else {
			var img = $(this).find('img').clone();

			$(this).closest('.gallery').find('.gallery__view').empty().append(img);

			$(this).closest('.gallery__list').find('.gallery__element_active').removeClass('gallery__element_active');
			$(this).addClass('gallery__element_active');
		}
	});

	$('.vlist__more').on('click', function () {
		$(this).closest('.vlist').toggleClass('vlist_allshow');
	});

	if ($('[data-modal]').get(0)) {
		$('[data-modal]').iziModal({
			width: 1180
		});
	}

	$('.gallery__view').on('click', function () {
		var img = $(this).find('img').clone();

		$('.modal_zoom .modal__content').html(img);

		$('.modal_zoom').iziModal('open');
	});

	init();

	$('.filter-toggle').on('click', function () {
		$('.filter .toggle:not(.toggle_close)').trigger('click');
		$('.filter').toggle();
	});

	$('.m-menu__toggle').on('click', function () {
		$('.m-menu__content').toggle();
	});

	$('.m-menu__item_drop').on('click', function (e) {
		e.stopPropagation();

		var drop = $(this).find('.m-menu__drop');

		$(drop).addClass('m-menu__drop_show');
	});

	$('.m-menu__back').on('click', function (e) {
		e.stopPropagation();

		$(this).closest('.m-menu__drop_show').removeClass('m-menu__drop_show');
	});
})(window);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJyb290IiwiaW5pdCIsIiQiLCJmaXJzdCIsInRyaWdnZXIiLCJlYWNoIiwicmFuZ2UiLCJtaW5JbnB1dCIsImNsb3Nlc3QiLCJmaW5kIiwibWF4SW5wdXQiLCJ1cGRhdGUiLCJmcm9tIiwiZGF0YSIsInRvIiwidmFsIiwiaW9uUmFuZ2VTbGlkZXIiLCJleHRyYV9jbGFzc2VzIiwiaGlkZV9taW5fbWF4IiwiaGlkZV9mcm9tX3RvIiwib24iLCJtaW4iLCJvcHRpb25zIiwibWF4Iiwic3RlcCIsImZpbGxlZCIsImZpZWxkIiwidHJpbSIsImxlbmd0aCIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJlIiwic3RvcFByb3BhZ2F0aW9uIiwiY29udGVudCIsInBhcmVudCIsInRvZ2dsZUNsYXNzIiwic3RvcCIsInNsaWRlVG9nZ2xlIiwiaSIsImJsb2NrIiwiY2hlY2tzIiwiYXBwZW5kIiwicmVtb3ZlIiwiaGFzQ2xhc3MiLCJzaWJsaW5ncyIsImRvY3VtZW50IiwiZHJvcCIsInRhcmdldCIsImdldCIsInRpcCIsImhpZGUiLCJzaG93IiwiY3NzIiwiZGF0YVNsaWRlcnMiLCJmZWF1dHVyZXMiLCJpdGVtcyIsIm5hdiIsImdhbGxlcnkiLCJkb3RzIiwibW91c2VEcmFnIiwicmVzcG9uc2l2ZSIsInNsaWRlciIsIm93bENhcm91c2VsIiwidmlkZW8iLCJjbG9uZSIsImh0bWwiLCJpemlNb2RhbCIsImltZyIsImVtcHR5Iiwid2lkdGgiLCJ0b2dnbGUiLCJ3aW5kb3ciXSwibWFwcGluZ3MiOiI7O0FBQUEsQ0FBQyxVQUFTQSxJQUFULEVBQWU7O0FBRWYsVUFBU0MsSUFBVCxHQUFnQjtBQUNmQyxJQUFFLG1CQUFGLEVBQXVCQyxLQUF2QixHQUErQkMsT0FBL0IsQ0FBdUMsT0FBdkM7QUFDQTs7QUFFREYsR0FBRSxnQkFBRixFQUFvQkcsSUFBcEIsQ0FBeUIsWUFBVztBQUNuQyxNQUFJQyxRQUFRLElBQVo7QUFBQSxNQUNFQyxX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LE9BQVIsQ0FBZ0Isb0JBQWhCLEVBQXNDc0IsV0FBdEMsQ0FBa0QsbUJBQWxEO0FBQ0EsRUFKRDtBQU9BLENBdlBELEVBdVBHeUMsTUF2UEgiLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKHJvb3QpIHtcblxuXHRmdW5jdGlvbiBpbml0KCkge1xuXHRcdCQoJy5nYWxsZXJ5X19lbGVtZW50JykuZmlyc3QoKS50cmlnZ2VyKCdjbGljaycpO1xuXHR9O1xuXG5cdCQoJy5yYW5nZV9fc2xpZGVyJykuZWFjaChmdW5jdGlvbigpIHtcblx0XHR2YXIgcmFuZ2UgPSB0aGlzLFxuXHRcdFx0XHRtaW5JbnB1dCA9ICQocmFuZ2UpLmNsb3Nlc3QoJy5yYW5nZScpLmZpbmQoJ1tkYXRhLWlucHV0PVwibWluXCJdJyksXG5cdFx0XHRcdG1heElucHV0ID0gJChyYW5nZSkuY2xvc2VzdCgnLnJhbmdlJykuZmluZCgnW2RhdGEtaW5wdXQ9XCJtYXhcIl0nKTtcblxuXHRcdGZ1bmN0aW9uIHVwZGF0ZSgpIHtcblx0XHRcdHZhciBmcm9tID0gJChyYW5nZSkuZGF0YSgnZnJvbScpLFxuXHRcdFx0XHRcdHRvID0gJChyYW5nZSkuZGF0YSgndG8nKTtcblxuXHRcdFx0JChtaW5JbnB1dCkudmFsKGZyb20pO1xuXHRcdFx0JChtYXhJbnB1dCkudmFsKHRvKTtcblx0XHR9XG5cblx0XHQkKHJhbmdlKS5pb25SYW5nZVNsaWRlcih7XG5cdFx0XHRleHRyYV9jbGFzc2VzOiAncmFuZ2VfX3NsaWRlcicsXG5cdFx0XHRoaWRlX21pbl9tYXg6IHRydWUsXG5cdFx0XHRoaWRlX2Zyb21fdG86IHRydWUsXG5cdFx0fSk7XG5cblx0XHR1cGRhdGUoKTtcblx0XHQkKHJhbmdlKS5vbignY2hhbmdlJywgdXBkYXRlKTtcblx0fSk7XG5cblx0JCgnW2RhdGEtaW5wdXRdJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCkge1xuXHRcdHZhciByYW5nZSA9ICQodGhpcykuY2xvc2VzdCgnLnJhbmdlJykuZmluZCgnaW5wdXQucmFuZ2VfX3NsaWRlcicpLmRhdGEoXCJpb25SYW5nZVNsaWRlclwiKSxcblx0XHRcdFx0dmFsID0gJCh0aGlzKS52YWwoKSxcblx0XHRcdFx0bWluID0gcmFuZ2Uub3B0aW9ucy5taW4sXG5cdFx0XHRcdG1heCA9IHJhbmdlLm9wdGlvbnMubWF4LFxuXHRcdFx0XHRmcm9tID0gcmFuZ2Uub3B0aW9ucy5mcm9tLFxuXHRcdFx0XHR0byA9IHJhbmdlLm9wdGlvbnMudG8sXG5cdFx0XHRcdHN0ZXAgPSByYW5nZS5vcHRpb25zLnN0ZXA7XG5cblx0XHRzd2l0Y2ggKCQodGhpcykuZGF0YSgnaW5wdXQnKSkge1xuXHRcdFx0Y2FzZSAnbWluJzpcblx0XHRcdFx0aWYgKHZhbCA8PSBtaW4pIHtcblx0XHRcdFx0XHR2YWwgPSBtaW47XG5cdFx0XHRcdH0gZWxzZSBpZiAodmFsID49IG1heCkge1xuXHRcdFx0XHRcdHZhbCA9IG1heCAtIHN0ZXA7XG5cdFx0XHRcdH0gZWxzZSBpZiAodmFsID49IHRvKSB7XG5cdFx0XHRcdFx0dmFsID0gdG8gLSBzdGVwO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmFuZ2UudXBkYXRlKHtcblx0XHRcdFx0XHRmcm9tOiB2YWxcblx0XHRcdFx0fSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnbWF4Jzpcblx0XHRcdFx0aWYgKHZhbCA+PSBtYXgpIHtcblx0XHRcdFx0XHR2YWwgPSBtYXg7XG5cdFx0XHRcdH0gZWxzZSBpZiAodmFsIDw9IG1pbikge1xuXHRcdFx0XHRcdHZhbCA9IG1pbiArIHN0ZXA7XG5cdFx0XHRcdH0gZWxzZSBpZiAodmFsIDw9IGZyb20pIHtcblx0XHRcdFx0XHR2YWwgPSBmcm9tICsgc3RlcDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJhbmdlLnVwZGF0ZSh7XG5cdFx0XHRcdFx0dG86IHZhbFxuXHRcdFx0XHR9KTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXG5cdFx0JCh0aGlzKS52YWwodmFsKTtcblxuXHR9KTtcblxuXHRmdW5jdGlvbiBmaWxsZWQoZmllbGQpIHtcblx0XHR2YXIgdmFsID0gJChmaWVsZCkudmFsKCkudHJpbSgpO1xuXG5cdFx0aWYgKHZhbC5sZW5ndGggPiAwKSB7XG5cdFx0XHQkKGZpZWxkKS5jbG9zZXN0KCcuZmllbGQnKS5hZGRDbGFzcygnZmllbGRfZmlsbGVkJyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdCQoZmllbGQpLmNsb3Nlc3QoJy5maWVsZCcpLnJlbW92ZUNsYXNzKCdmaWVsZF9maWxsZWQnKTtcblx0XHR9XG5cdH1cblxuXHQkKCcuZmllbGQgaW5wdXQnKS5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdGZpbGxlZCh0aGlzKTtcblx0fSk7XG5cblx0JCgnLnRvZ2dsZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblx0XHRlLnN0b3BQcm9wYWdhdGlvbigpXG5cdFx0dmFyIGNvbnRlbnQgPSAkKHRoaXMpLnBhcmVudCgpLmZpbmQoJCgnLicrJCh0aGlzKS5kYXRhKCd0b2dnbGUnKSkpO1xuXHRcdCQodGhpcykudG9nZ2xlQ2xhc3MoJ3RvZ2dsZV9jbG9zZScpO1xuXHRcdCQoY29udGVudCkuc3RvcCgpLnNsaWRlVG9nZ2xlKDMwMCk7XG5cdH0pO1xuXG5cdCQoJy5maWx0ZXJfX2Jsb2NrLWNvbnRlbnQnKS5lYWNoKGZ1bmN0aW9uKGksIGJsb2NrKSB7XG5cdFx0dmFyIGNoZWNrcyA9ICQoYmxvY2spLmZpbmQoJy5jaGVja2JveCcpLmxlbmd0aDtcblxuXHRcdGlmIChjaGVja3MgPiA1KSB7XG5cdFx0XHQkKGJsb2NrKS5hZGRDbGFzcygnZmlsdGVyX19ibG9jay1jb250ZW50X21vcmUnKTtcblx0XHRcdCQoYmxvY2spLmFwcGVuZCgnPHNwYW4gY2xhc3M9XCJmaWx0ZXJfX2Jsb2NrLW1vcmVcIj7Qn9C+0LrQsNC30LDRgtGMINCy0YHQtTwvc3Bhbj4nKTtcblx0XHR9XG5cdH0pO1xuXG5cdCQoJy5maWx0ZXJfX2Jsb2NrLW1vcmUnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHQkKHRoaXMpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdmaWx0ZXJfX2Jsb2NrLWNvbnRlbnRfbW9yZScpO1xuXHRcdCQodGhpcykucmVtb3ZlKCk7XG5cdH0pO1xuXG5cdCQoJy5kcm9wX19pdGVtJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0aWYgKCEkKHRoaXMpLmhhc0NsYXNzKCdkcm9wX19pdGVtX2xpbmsnKSkge1xuXHRcdFx0JCh0aGlzKS5hZGRDbGFzcygnZHJvcF9faXRlbV9hY3RpdmUnKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCdkcm9wX19pdGVtX2FjdGl2ZScpO1xuXHRcdH1cblxuXHRcdCQodGhpcykuY2xvc2VzdCgnW2RhdGEtZHJvcF0nKS5yZW1vdmVDbGFzcygnZHJvcC1vcGVuJyk7XG5cdH0pO1xuXG5cdCQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdbZGF0YS1kcm9wXScsIGZ1bmN0aW9uKCkge1xuXG5cdFx0dmFyIGRhdGEgPSAkKHRoaXMpLmRhdGEoJ2Ryb3AnKTtcblxuXHRcdGlmIChkYXRhID09ICd0cmlnZ2VyJykge1xuXHRcdFx0JCgnLmRyb3Atb3BlbicpLnJlbW92ZUNsYXNzKCdkcm9wLW9wZW4nKTtcblx0XHRcdCQodGhpcykucGFyZW50KCkuY2xvc2VzdCgnW2RhdGEtZHJvcF0nKS5hZGRDbGFzcygnZHJvcC1vcGVuJyk7XG5cdFx0fSBlbHNlIHJldHVybjtcblxuXHR9KTtcblxuXHQkKGRvY3VtZW50KS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG5cblx0XHR2YXIgZHJvcCA9ICQoZS50YXJnZXQpLnBhcmVudCgpLmNsb3Nlc3QoJ1tkYXRhLWRyb3BdJykuZ2V0KDApLFxuXHRcdFx0XHR0aXAgPSAkKGUudGFyZ2V0KS5wYXJlbnQoKS5jbG9zZXN0KCcudGlwJykuZ2V0KDApO1xuXG5cdFx0aWYgKCFkcm9wKSB7XG5cdFx0XHQkKCcuZHJvcC1vcGVuJykucmVtb3ZlQ2xhc3MoJ2Ryb3Atb3BlbicpO1xuXHRcdH1cblxuXHRcdGlmICghdGlwKSB7XG5cdFx0XHQkKCcudGlwX19oaWRlY29udGVudCcpLmhpZGUoKTtcblx0XHR9XG5cblx0fSlcblxuXHQkKCcuZGVzY3JpcHRpb25fX3Nob3cnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHQkKHRoaXMpLmhpZGUoKTtcblx0XHQkKCcuZGVzY3JpcHRpb25fX21vcmUnKS5zaG93KCk7XG5cdH0pO1xuXG5cdCQoJ1tkYXRhLWNsb3NlXScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdCQodGhpcykucGFyZW50KCkuaGlkZSgpO1xuXHRcdCQodGhpcykuY2xvc2VzdCgnLmNhcmQnKS5jc3MoJ3otaW5kZXgnLCAnJyk7XG5cdH0pO1xuXG5cdCQoJy50aXBfX25hbWUnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHQkKCcuY2FyZCcpLmNzcygnei1pbmRleCcsICcnKTtcblx0XHQkKCcudGlwX19oaWRlY29udGVudCcpLmhpZGUoKTtcblx0XHQkKHRoaXMpLnBhcmVudCgpLmZpbmQoJy50aXBfX2hpZGVjb250ZW50Jykuc2hvdygpO1xuXHRcdCQodGhpcykuY2xvc2VzdCgnLmNhcmQnKS5jc3MoJ3otaW5kZXgnLCAnMicpO1xuXHR9KTtcblxuXHR2YXIgZGF0YVNsaWRlcnMgPSB7XG5cdFx0ZmVhdXR1cmVzOiB7XG5cdFx0XHRpdGVtczogNixcblx0XHRcdG5hdjogdHJ1ZVxuXHRcdH0sXG5cdFx0Z2FsbGVyeToge1xuXHRcdFx0aXRlbXM6IDEsXG5cdFx0XHRuYXY6IHRydWUsXG5cdFx0XHRkb3RzOiB0cnVlLFxuXHRcdFx0bW91c2VEcmFnOiBmYWxzZSxcblx0XHRcdHJlc3BvbnNpdmU6IHtcblx0XHRcdFx0OTYxOiB7XG5cdFx0XHRcdFx0aXRlbXM6IDQsXG5cdFx0XHRcdFx0ZG90czogZmFsc2Vcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdCQoJ1tkYXRhLXNsaWRlcl0nKS5lYWNoKGZ1bmN0aW9uKGksIHNsaWRlcikge1xuXHRcdHZhciBkYXRhID0gJCh0aGlzKS5kYXRhKCdzbGlkZXInKTtcblxuXHRcdCQoc2xpZGVyKS5vd2xDYXJvdXNlbChkYXRhU2xpZGVyc1tkYXRhXSlcblx0fSk7XG5cblx0Ly8gR2FsbGVyeVxuXHQkKCcuZ2FsbGVyeV9fZWxlbWVudCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuXG5cdFx0aWYgKCQodGhpcykuaGFzQ2xhc3MoJ2dhbGxlcnlfX2VsZW1lbnRfdmlkZW8nKSkge1xuXHRcdFx0dmFyIHZpZGVvID0gJCh0aGlzKS5maW5kKCd2aWRlbycpLmNsb25lKCk7XG5cblx0XHRcdCQoJy5tb2RhbF96b29tIC5tb2RhbF9fY29udGVudCcpLmh0bWwodmlkZW8pO1xuXG5cdFx0XHQkKCcubW9kYWxfem9vbScpLml6aU1vZGFsKCdvcGVuJyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHZhciBpbWcgPSAkKHRoaXMpLmZpbmQoJ2ltZycpLmNsb25lKCk7XG5cblx0XHRcdCQodGhpcykuY2xvc2VzdCgnLmdhbGxlcnknKS5maW5kKCcuZ2FsbGVyeV9fdmlldycpLmVtcHR5KCkuYXBwZW5kKGltZyk7XG5cblx0XHRcdCQodGhpcykuY2xvc2VzdCgnLmdhbGxlcnlfX2xpc3QnKS5maW5kKCcuZ2FsbGVyeV9fZWxlbWVudF9hY3RpdmUnKS5yZW1vdmVDbGFzcygnZ2FsbGVyeV9fZWxlbWVudF9hY3RpdmUnKTtcblx0XHRcdCQodGhpcykuYWRkQ2xhc3MoJ2dhbGxlcnlfX2VsZW1lbnRfYWN0aXZlJyk7XG5cdFx0fVxuXG5cdH0pO1xuXG5cdCQoJy52bGlzdF9fbW9yZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdCQodGhpcykuY2xvc2VzdCgnLnZsaXN0JykudG9nZ2xlQ2xhc3MoJ3ZsaXN0X2FsbHNob3cnKTtcblx0fSk7XG5cblx0aWYgKCQoJ1tkYXRhLW1vZGFsXScpLmdldCgwKSkge1xuXHRcdCQoJ1tkYXRhLW1vZGFsXScpLml6aU1vZGFsKHtcblx0XHRcdHdpZHRoOiAxMTgwXG5cdFx0fSk7XG5cdH1cblxuXG5cdCQoJy5nYWxsZXJ5X192aWV3Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0dmFyIGltZyA9ICQodGhpcykuZmluZCgnaW1nJykuY2xvbmUoKTtcblxuXHRcdCQoJy5tb2RhbF96b29tIC5tb2RhbF9fY29udGVudCcpLmh0bWwoaW1nKVxuXG5cdFx0JCgnLm1vZGFsX3pvb20nKS5pemlNb2RhbCgnb3BlbicpO1xuXHR9KTtcblxuXHRpbml0KCk7XG5cblx0JCgnLmZpbHRlci10b2dnbGUnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHQkKCcuZmlsdGVyIC50b2dnbGU6bm90KC50b2dnbGVfY2xvc2UpJykudHJpZ2dlcignY2xpY2snKTtcblx0XHQkKCcuZmlsdGVyJykudG9nZ2xlKCk7XG5cdH0pO1xuXG5cdCQoJy5tLW1lbnVfX3RvZ2dsZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdCQoJy5tLW1lbnVfX2NvbnRlbnQnKS50b2dnbGUoKTtcblx0fSk7XG5cblx0JCgnLm0tbWVudV9faXRlbV9kcm9wJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cblx0XHR2YXIgZHJvcCA9ICQodGhpcykuZmluZCgnLm0tbWVudV9fZHJvcCcpO1xuXG5cdFx0JChkcm9wKS5hZGRDbGFzcygnbS1tZW51X19kcm9wX3Nob3cnKTtcblx0fSk7XG5cblx0JCgnLm0tbWVudV9fYmFjaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG5cdFx0JCh0aGlzKS5jbG9zZXN0KCcubS1tZW51X19kcm9wX3Nob3cnKS5yZW1vdmVDbGFzcygnbS1tZW51X19kcm9wX3Nob3cnKTtcblx0fSk7XG5cblxufSkod2luZG93KTtcbiJdfQ==
