'use strict';

(function (root) {

	// Инициализация прилдожения
	var windowWidth = $(window).width();

	function init() {

		if ($('.gallery').get(0)) {
			$('.gallery__element').first().trigger('click');
		}

		$('[data-tabs]').each(function (i, tabs) {
			$(tabs).children().first().trigger('click');
		});

		$('.toggle_close').each(function (i, toggle) {
			var data = $(this).data('toggle');

			$(this).parent().find('.' + data).hide();
		});
	};

	$(window).on('resize', function () {
		windowWidth = $(window).width();
	});

	// Слайдеры
	var dataSliders = {
		feautures: {
			items: 6,
			nav: true
		},
		gallery: {
			items: 1,
			nav: true,
			dots: true,
			mouseDrag: false,
			responsive: {
				961: {
					items: 4,
					dots: false
				}
			}
		},
		promo: {
			items: 1,
			dots: true,
			loop: true,
			autoplay: true
		}
	};

	$('[data-slider]').each(function (i, slider) {
		var data = $(this).data('slider');

		$(slider).owlCarousel(dataSliders[data]);
	});

	$('.range__slider').each(function () {
		var range = this,
		    minInput = $(range).closest('.range').find('[data-input="min"]'),
		    maxInput = $(range).closest('.range').find('[data-input="max"]');

		function update() {
			var from = $(range).data('from'),
			    to = $(range).data('to');

			$(minInput).val(from);
			$(maxInput).val(to);
		}

		$(range).ionRangeSlider({
			extra_classes: 'range__slider',
			hide_min_max: true,
			hide_from_to: true
		});

		update();
		$(range).on('change', update);
	});

	$('[data-input]').on('change', function () {
		var range = $(this).closest('.range').find('input.range__slider').data("ionRangeSlider"),
		    val = $(this).val(),
		    min = range.options.min,
		    max = range.options.max,
		    from = range.options.from,
		    to = range.options.to,
		    step = range.options.step;

		switch ($(this).data('input')) {
			case 'min':
				if (val <= min) {
					val = min;
				} else if (val >= max) {
					val = max - step;
				} else if (val >= to) {
					val = to - step;
				}

				range.update({
					from: val
				});
				break;
			case 'max':
				if (val >= max) {
					val = max;
				} else if (val <= min) {
					val = min + step;
				} else if (val <= from) {
					val = from + step;
				}

				range.update({
					to: val
				});
				break;
		}

		$(this).val(val);
	});

	function filled(field) {
		var val = $(field).val().trim();

		if (val.length > 0) {
			$(field).closest('.field').addClass('field_filled');
		} else {
			$(field).closest('.field').removeClass('field_filled');
		}
	}

	$('.field input').each(function () {
		filled(this);
	});

	$('.toggle').on('click', function (e) {
		e.stopPropagation();
		var content = $(this).parent().find($('.' + $(this).data('toggle')));
		$(this).toggleClass('toggle_close');
		$(content).stop().slideToggle(300);
	});

	$('.filter__block-content').each(function (i, block) {
		var checks = $(block).find('.checkbox').length;

		if (checks > 5) {
			$(block).addClass('filter__block-content_more');
			$(block).append('<span class="filter__block-more">Показать все</span>');
		}
	});

	$('.filter__block-more').on('click', function () {
		$(this).parent().removeClass('filter__block-content_more');
		$(this).remove();
	});

	$('.drop__item').on('click', function () {
		if (!$(this).hasClass('drop__item_link')) {
			$(this).addClass('drop__item_active').siblings().removeClass('drop__item_active');
		}

		$(this).closest('[data-drop]').removeClass('drop-open');
	});

	$(document).on('click', '[data-drop]', function () {

		var data = $(this).data('drop');

		if (data == 'trigger') {
			$('.drop-open').removeClass('drop-open');
			$(this).parent().closest('[data-drop]').addClass('drop-open');
		} else return;
	});

	$(document).on('click', function (e) {

		var drop = $(e.target).parent().closest('[data-drop]').get(0),
		    tip = $(e.target).parent().closest('.tip').get(0);

		if ($(e.target).hasClass('counter__btn_plus')) return;

		if (!drop) {
			$('.drop-open').removeClass('drop-open');
		}

		if (!tip) {
			$('.tip__hidecontent').hide();
		}
	});

	$('.description__show').on('click', function () {
		$(this).hide();
		$('.description__short').hide();
		$('.description__all').show();
	});

	$('[data-close]').on('click', function () {
		$(this).parent().hide();
		$(this).closest('.card').css('z-index', '');
	});

	$('.tip__name').on('click', function () {
		$('.card').css('z-index', '');
		$('.tip__hidecontent').hide();
		$(this).parent().find('.tip__hidecontent').show();
		$(this).closest('.card').css('z-index', '2');
	});

	// Gallery
	$('.gallery__element').on('click', function () {

		if ($(this).hasClass('gallery__element_video')) {
			var video = $(this).find('video').clone();

			$('.modal_zoom .modal__content').html(video);

			$('.modal_zoom').iziModal('open');
		} else {
			var img = $(this).find('img').clone();

			$(this).closest('.gallery').find('.gallery__view').empty().append(img);

			$(this).closest('.gallery__list').find('.gallery__element_active').removeClass('gallery__element_active');
			$(this).addClass('gallery__element_active');
		}
	});

	$('.vlist_full').each(function (i, list) {
		var show = $(list).data('show'),
		    line = $(list).find('.vlist__line:not(.vlist__line_head)').get(show);

		$(line).hide().nextAll(':not(.vlist__line_more)').hide();
	});

	$('.vlist__more').on('click', function () {
		$(this).closest('.vlist').toggleClass('vlist_allshow');
	});

	if ($('[data-modal]').get(0)) {
		$('[data-modal]').iziModal({
			width: 1180
		});
	}

	$('.gallery__view').on('click', function () {
		var img = $(this).find('img').clone();

		$('.modal_zoom .modal__content').html(img);

		$('.modal_zoom').iziModal('open');
	});

	$('.filter-toggle').on('click', function () {
		$('.filter .toggle:not(.toggle_close)').trigger('click');
		$('.filter').toggle();
	});

	$('.m-menu__toggle').on('click', function () {
		$('.m-menu__content').toggle();
	});

	$('.m-menu__item_drop').on('click', function (e) {
		e.stopPropagation();

		var drop = $(this).find('.m-menu__drop').first();

		if ($(e.target).parentsUntil('.m-menu__item_drop').length <= 1) {
			$(drop).toggleClass('m-menu__drop_show');
		}
	});

	$('.m-menu__back').on('click', function (e) {
		e.stopPropagation();

		$(this).closest('.m-menu__drop_show').removeClass('m-menu__drop_show');
	});

	$('[data-tabs] > *').on('click', function (e) {
		e.preventDefault();

		var data = $(this).parent().data('tabs'),
		    index = $(this).index(),
		    content = $('[data-tabs-content=' + data + ']').children().get(index);

		$(content).show().siblings().hide();

		if (!content) {
			$('[data-tabs-content=' + data + ']').children().hide();
		}

		$(this).addClass('active').siblings().removeClass('active');
	});

	if ($('.modal_video').get(0)) {
		$(".modal_video").iziModal({
			history: false,
			iframe: true,
			fullscreen: true,
			headerColor: '#000000',
			group: 'group1',
			loop: true
		});
	}

	$('.video').on('click', function () {
		var id = $(this).data('id');

		$('#' + id).iziModal('open');
	});

	$('.checkbox input').on('click', function (e) {
		e.stopPropagation();

		$(this).closest('.checkbox').toggleClass('checkbox_active');
	});

	var scrolling,
	    toTop = document.querySelector('.to-top');

	document.addEventListener('scroll', function () {
		scrolling = document.body.scrollTop;

		if (scrolling >= 1000 && windowWidth > 960) {
			toTop.classList.add('to-top_show');
		} else {
			toTop.classList.remove('to-top_show');
		}
	}, true);

	$('.to-top').on('click', function () {
		$("html, body").stop().animate({ scrollTop: 0 }, 500, 'swing');
	});

	$('.counter__btn_plus').on('click', function () {
		$('.tip__hidecontent').hide();
		$(this).parent().find('.tip__hidecontent').first().show();
	});

	init();
})(window);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJyb290Iiwid2luZG93V2lkdGgiLCIkIiwid2luZG93Iiwid2lkdGgiLCJpbml0IiwiZ2V0IiwiZmlyc3QiLCJ0cmlnZ2VyIiwiZWFjaCIsImkiLCJ0YWJzIiwiY2hpbGRyZW4iLCJ0b2dnbGUiLCJkYXRhIiwicGFyZW50IiwiZmluZCIsImhpZGUiLCJvbiIsImRhdGFTbGlkZXJzIiwiZmVhdXR1cmVzIiwiaXRlbXMiLCJuYXYiLCJnYWxsZXJ5IiwiZG90cyIsIm1vdXNlRHJhZyIsInJlc3BvbnNpdmUiLCJwcm9tbyIsImxvb3AiLCJhdXRvcGxheSIsInNsaWRlciIsIm93bENhcm91c2VsIiwicmFuZ2UiLCJtaW5JbnB1dCIsImNsb3Nlc3QiLCJtYXhJbnB1dCIsInVwZGF0ZSIsImZyb20iLCJ0byIsInZhbCIsImlvblJhbmdlU2xpZGVyIiwiZXh0cmFfY2xhc3NlcyIsImhpZGVfbWluX21heCIsImhpZGVfZnJvbV90byIsIm1pbiIsIm9wdGlvbnMiLCJtYXgiLCJzdGVwIiwiZmlsbGVkIiwiZmllbGQiLCJ0cmltIiwibGVuZ3RoIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsImUiLCJzdG9wUHJvcGFnYXRpb24iLCJjb250ZW50IiwidG9nZ2xlQ2xhc3MiLCJzdG9wIiwic2xpZGVUb2dnbGUiLCJibG9jayIsImNoZWNrcyIsImFwcGVuZCIsInJlbW92ZSIsImhhc0NsYXNzIiwic2libGluZ3MiLCJkb2N1bWVudCIsImRyb3AiLCJ0YXJnZXQiLCJ0aXAiLCJzaG93IiwiY3NzIiwidmlkZW8iLCJjbG9uZSIsImh0bWwiLCJpemlNb2RhbCIsImltZyIsImVtcHR5IiwibGlzdCIsImxpbmUiLCJuZXh0QWxsIiwicGFyZW50c1VudGlsIiwicHJldmVudERlZmF1bHQiLCJpbmRleCIsImhpc3RvcnkiLCJpZnJhbWUiLCJmdWxsc2NyZWVuIiwiaGVhZGVyQ29sb3IiLCJncm91cCIsImlkIiwic2Nyb2xsaW5nIiwidG9Ub3AiLCJxdWVyeVNlbGVjdG9yIiwiYWRkRXZlbnRMaXN0ZW5lciIsImJvZHkiLCJzY3JvbGxUb3AiLCJjbGFzc0xpc3QiLCJhZGQiLCJhbmltYXRlIl0sIm1hcHBpbmdzIjoiOztBQUFBLENBQUMsVUFBU0EsSUFBVCxFQUFlOztBQUVmO0FBQ0EsS0FBSUMsY0FBY0MsRUFBRUMsTUFBRixFQUFVQyxLQUFWLEVBQWxCOztBQUVBLFVBQVNDLElBQVQsR0FBZ0I7O0FBRWYsTUFBSUgsRUFBRSxVQUFGLEVBQWNJLEdBQWQsQ0FBa0IsQ0FBbEIsQ0FBSixFQUEwQjtBQUN6QkosS0FBRSxtQkFBRixFQUF1QkssS0FBdkIsR0FBK0JDLE9BQS9CLENBQXVDLE9BQXZDO0FBQ0E7O0FBRUROLElBQUUsYUFBRixFQUFpQk8sSUFBakIsQ0FBc0IsVUFBU0MsQ0FBVCxFQUFZQyxJQUFaLEVBQWtCO0FBQ3ZDVCxLQUFFUyxJQUFGLEVBQVFDLFFBQVIsR0FBbUJMLEtBQW5CLEdBQTJCQyxPQUEzQixDQUFtQyxPQUFuQztBQUNBLEdBRkQ7O0FBSUFOLElBQUUsZUFBRixFQUFtQk8sSUFBbkIsQ0FBd0IsVUFBU0MsQ0FBVCxFQUFZRyxNQUFaLEVBQW9CO0FBQzNDLE9BQUlDLE9BQU9aLEVBQUUsSUFBRixFQUFRWSxJQUFSLENBQWEsUUFBYixDQUFYOztBQUVBWixLQUFFLElBQUYsRUFBUWEsTUFBUixHQUFpQkMsSUFBakIsQ0FBc0IsTUFBSUYsSUFBMUIsRUFBZ0NHLElBQWhDO0FBQ0EsR0FKRDtBQUtBOztBQUVEZixHQUFFQyxNQUFGLEVBQVVlLEVBQVYsQ0FBYSxRQUFiLEVBQXVCLFlBQVc7QUFDakNqQixnQkFBY0MsRUFBRUMsTUFBRixFQUFVQyxLQUFWLEVBQWQ7QUFDQSxFQUZEOztBQUlBO0FBQ0EsS0FBSWUsY0FBYztBQUNqQkMsYUFBVztBQUNWQyxVQUFPLENBREc7QUFFVkMsUUFBSztBQUZLLEdBRE07QUFLakJDLFdBQVM7QUFDUkYsVUFBTyxDQURDO0FBRVJDLFFBQUssSUFGRztBQUdSRSxTQUFNLElBSEU7QUFJUkMs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QVQsQ0FBY0MsU0FBMUI7O0FBRUEsTUFBSUwsYUFBYSxJQUFiLElBQXFCekYsY0FBYyxHQUF2QyxFQUE0QztBQUMzQzBGLFNBQU1LLFNBQU4sQ0FBZ0JDLEdBQWhCLENBQW9CLGFBQXBCO0FBQ0EsR0FGRCxNQUVPO0FBQ05OLFNBQU1LLFNBQU4sQ0FBZ0JqQyxNQUFoQixDQUF1QixhQUF2QjtBQUNBO0FBQ0YsRUFSRCxFQVFHLElBUkg7O0FBVUE3RCxHQUFFLFNBQUYsRUFBYWdCLEVBQWIsQ0FBZ0IsT0FBaEIsRUFBeUIsWUFBVztBQUNuQ2hCLElBQUUsWUFBRixFQUFnQndELElBQWhCLEdBQXVCd0MsT0FBdkIsQ0FBK0IsRUFBQ0gsV0FBVSxDQUFYLEVBQS9CLEVBQThDLEdBQTlDLEVBQW1ELE9BQW5EO0FBQ0EsRUFGRDs7QUFJQTdGLEdBQUUsb0JBQUYsRUFBd0JnQixFQUF4QixDQUEyQixPQUEzQixFQUFvQyxZQUFXO0FBQzlDaEIsSUFBRSxtQkFBRixFQUF1QmUsSUFBdkI7QUFDQWYsSUFBRSxJQUFGLEVBQVFhLE1BQVIsR0FBaUJDLElBQWpCLENBQXNCLG1CQUF0QixFQUEyQ1QsS0FBM0MsR0FBbUQrRCxJQUFuRDtBQUNBLEVBSEQ7O0FBS0FqRTtBQUdBLENBL1ZELEVBK1ZHRixNQS9WSCIsImZpbGUiOiJzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24ocm9vdCkge1xuXG5cdC8vINCY0L3QuNGG0LjQsNC70LjQt9Cw0YbQuNGPINC/0YDQuNC70LTQvtC20LXQvdC40Y9cblx0dmFyIHdpbmRvd1dpZHRoID0gJCh3aW5kb3cpLndpZHRoKCk7XG5cblx0ZnVuY3Rpb24gaW5pdCgpIHtcblxuXHRcdGlmICgkKCcuZ2FsbGVyeScpLmdldCgwKSkge1xuXHRcdFx0JCgnLmdhbGxlcnlfX2VsZW1lbnQnKS5maXJzdCgpLnRyaWdnZXIoJ2NsaWNrJyk7XG5cdFx0fVxuXG5cdFx0JCgnW2RhdGEtdGFic10nKS5lYWNoKGZ1bmN0aW9uKGksIHRhYnMpIHtcblx0XHRcdCQodGFicykuY2hpbGRyZW4oKS5maXJzdCgpLnRyaWdnZXIoJ2NsaWNrJyk7XG5cdFx0fSk7XG5cblx0XHQkKCcudG9nZ2xlX2Nsb3NlJykuZWFjaChmdW5jdGlvbihpLCB0b2dnbGUpIHtcblx0XHRcdHZhciBkYXRhID0gJCh0aGlzKS5kYXRhKCd0b2dnbGUnKTtcblxuXHRcdFx0JCh0aGlzKS5wYXJlbnQoKS5maW5kKCcuJytkYXRhKS5oaWRlKCk7XG5cdFx0fSk7XG5cdH07XG5cblx0JCh3aW5kb3cpLm9uKCdyZXNpemUnLCBmdW5jdGlvbigpIHtcblx0XHR3aW5kb3dXaWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xuXHR9KTtcblxuXHQvLyDQodC70LDQudC00LXRgNGLXG5cdHZhciBkYXRhU2xpZGVycyA9IHtcblx0XHRmZWF1dHVyZXM6IHtcblx0XHRcdGl0ZW1zOiA2LFxuXHRcdFx0bmF2OiB0cnVlXG5cdFx0fSxcblx0XHRnYWxsZXJ5OiB7XG5cdFx0XHRpdGVtczogMSxcblx0XHRcdG5hdjogdHJ1ZSxcblx0XHRcdGRvdHM6IHRydWUsXG5cdFx0XHRtb3VzZURyYWc6IGZhbHNlLFxuXHRcdFx0cmVzcG9uc2l2ZToge1xuXHRcdFx0XHQ5NjE6IHtcblx0XHRcdFx0XHRpdGVtczogNCxcblx0XHRcdFx0XHRkb3RzOiBmYWxzZVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRwcm9tbzoge1xuXHRcdFx0aXRlbXM6IDEsXG5cdFx0XHRkb3RzOiB0cnVlLFxuXHRcdFx0bG9vcDogdHJ1ZSxcblx0XHRcdGF1dG9wbGF5OiB0cnVlLFxuXHRcdH1cblx0fVxuXG5cdCQoJ1tkYXRhLXNsaWRlcl0nKS5lYWNoKGZ1bmN0aW9uKGksIHNsaWRlcikge1xuXHRcdHZhciBkYXRhID0gJCh0aGlzKS5kYXRhKCdzbGlkZXInKTtcblxuXHRcdCQoc2xpZGVyKS5vd2xDYXJvdXNlbChkYXRhU2xpZGVyc1tkYXRhXSlcblx0fSk7XG5cblx0JCgnLnJhbmdlX19zbGlkZXInKS5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdHZhciByYW5nZSA9IHRoaXMsXG5cdFx0XHRcdG1pbklucHV0ID0gJChyYW5nZSkuY2xvc2VzdCgnLnJhbmdlJykuZmluZCgnW2RhdGEtaW5wdXQ9XCJtaW5cIl0nKSxcblx0XHRcdFx0bWF4SW5wdXQgPSAkKHJhbmdlKS5jbG9zZXN0KCcucmFuZ2UnKS5maW5kKCdbZGF0YS1pbnB1dD1cIm1heFwiXScpO1xuXG5cdFx0ZnVuY3Rpb24gdXBkYXRlKCkge1xuXHRcdFx0dmFyIGZyb20gPSAkKHJhbmdlKS5kYXRhKCdmcm9tJyksXG5cdFx0XHRcdFx0dG8gPSAkKHJhbmdlKS5kYXRhKCd0bycpO1xuXG5cdFx0XHQkKG1pbklucHV0KS52YWwoZnJvbSk7XG5cdFx0XHQkKG1heElucHV0KS52YWwodG8pO1xuXHRcdH1cblxuXHRcdCQocmFuZ2UpLmlvblJhbmdlU2xpZGVyKHtcblx0XHRcdGV4dHJhX2NsYXNzZXM6ICdyYW5nZV9fc2xpZGVyJyxcblx0XHRcdGhpZGVfbWluX21heDogdHJ1ZSxcblx0XHRcdGhpZGVfZnJvbV90bzogdHJ1ZSxcblx0XHR9KTtcblxuXHRcdHVwZGF0ZSgpO1xuXHRcdCQocmFuZ2UpLm9uKCdjaGFuZ2UnLCB1cGRhdGUpO1xuXHR9KTtcblxuXHQkKCdbZGF0YS1pbnB1dF0nKS5vbignY2hhbmdlJywgZnVuY3Rpb24oKSB7XG5cdFx0dmFyIHJhbmdlID0gJCh0aGlzKS5jbG9zZXN0KCcucmFuZ2UnKS5maW5kKCdpbnB1dC5yYW5nZV9fc2xpZGVyJykuZGF0YShcImlvblJhbmdlU2xpZGVyXCIpLFxuXHRcdFx0XHR2YWwgPSAkKHRoaXMpLnZhbCgpLFxuXHRcdFx0XHRtaW4gPSByYW5nZS5vcHRpb25zLm1pbixcblx0XHRcdFx0bWF4ID0gcmFuZ2Uub3B0aW9ucy5tYXgsXG5cdFx0XHRcdGZyb20gPSByYW5nZS5vcHRpb25zLmZyb20sXG5cdFx0XHRcdHRvID0gcmFuZ2Uub3B0aW9ucy50byxcblx0XHRcdFx0c3RlcCA9IHJhbmdlLm9wdGlvbnMuc3RlcDtcblxuXHRcdHN3aXRjaCAoJCh0aGlzKS5kYXRhKCdpbnB1dCcpKSB7XG5cdFx0XHRjYXNlICdtaW4nOlxuXHRcdFx0XHRpZiAodmFsIDw9IG1pbikge1xuXHRcdFx0XHRcdHZhbCA9IG1pbjtcblx0XHRcdFx0fSBlbHNlIGlmICh2YWwgPj0gbWF4KSB7XG5cdFx0XHRcdFx0dmFsID0gbWF4IC0gc3RlcDtcblx0XHRcdFx0fSBlbHNlIGlmICh2YWwgPj0gdG8pIHtcblx0XHRcdFx0XHR2YWwgPSB0byAtIHN0ZXA7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyYW5nZS51cGRhdGUoe1xuXHRcdFx0XHRcdGZyb206IHZhbFxuXHRcdFx0XHR9KTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdtYXgnOlxuXHRcdFx0XHRpZiAodmFsID49IG1heCkge1xuXHRcdFx0XHRcdHZhbCA9IG1heDtcblx0XHRcdFx0fSBlbHNlIGlmICh2YWwgPD0gbWluKSB7XG5cdFx0XHRcdFx0dmFsID0gbWluICsgc3RlcDtcblx0XHRcdFx0fSBlbHNlIGlmICh2YWwgPD0gZnJvbSkge1xuXHRcdFx0XHRcdHZhbCA9IGZyb20gKyBzdGVwO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmFuZ2UudXBkYXRlKHtcblx0XHRcdFx0XHR0bzogdmFsXG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cblx0XHQkKHRoaXMpLnZhbCh2YWwpO1xuXG5cdH0pO1xuXG5cdGZ1bmN0aW9uIGZpbGxlZChmaWVsZCkge1xuXHRcdHZhciB2YWwgPSAkKGZpZWxkKS52YWwoKS50cmltKCk7XG5cblx0XHRpZiAodmFsLmxlbmd0aCA+IDApIHtcblx0XHRcdCQoZmllbGQpLmNsb3Nlc3QoJy5maWVsZCcpLmFkZENsYXNzKCdmaWVsZF9maWxsZWQnKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0JChmaWVsZCkuY2xvc2VzdCgnLmZpZWxkJykucmVtb3ZlQ2xhc3MoJ2ZpZWxkX2ZpbGxlZCcpO1xuXHRcdH1cblx0fVxuXG5cdCQoJy5maWVsZCBpbnB1dCcpLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0ZmlsbGVkKHRoaXMpO1xuXHR9KTtcblxuXHQkKCcudG9nZ2xlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdGUuc3RvcFByb3BhZ2F0aW9uKClcblx0XHR2YXIgY29udGVudCA9ICQodGhpcykucGFyZW50KCkuZmluZCgkKCcuJyskKHRoaXMpLmRhdGEoJ3RvZ2dsZScpKSk7XG5cdFx0JCh0aGlzKS50b2dnbGVDbGFzcygndG9nZ2xlX2Nsb3NlJyk7XG5cdFx0JChjb250ZW50KS5zdG9wKCkuc2xpZGVUb2dnbGUoMzAwKTtcblx0fSk7XG5cblx0JCgnLmZpbHRlcl9fYmxvY2stY29udGVudCcpLmVhY2goZnVuY3Rpb24oaSwgYmxvY2spIHtcblx0XHR2YXIgY2hlY2tzID0gJChibG9jaykuZmluZCgnLmNoZWNrYm94JykubGVuZ3RoO1xuXG5cdFx0aWYgKGNoZWNrcyA+IDUpIHtcblx0XHRcdCQoYmxvY2spLmFkZENsYXNzKCdmaWx0ZXJfX2Jsb2NrLWNvbnRlbnRfbW9yZScpO1xuXHRcdFx0JChibG9jaykuYXBwZW5kKCc8c3BhbiBjbGFzcz1cImZpbHRlcl9fYmxvY2stbW9yZVwiPtCf0L7QutCw0LfQsNGC0Ywg0LLRgdC1PC9zcGFuPicpO1xuXHRcdH1cblx0fSk7XG5cblx0JCgnLmZpbHRlcl9fYmxvY2stbW9yZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdCQodGhpcykucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ2ZpbHRlcl9fYmxvY2stY29udGVudF9tb3JlJyk7XG5cdFx0JCh0aGlzKS5yZW1vdmUoKTtcblx0fSk7XG5cblx0JCgnLmRyb3BfX2l0ZW0nKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHRpZiAoISQodGhpcykuaGFzQ2xhc3MoJ2Ryb3BfX2l0ZW1fbGluaycpKSB7XG5cdFx0XHQkKHRoaXMpLmFkZENsYXNzKCdkcm9wX19pdGVtX2FjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ2Ryb3BfX2l0ZW1fYWN0aXZlJyk7XG5cdFx0fVxuXG5cdFx0JCh0aGlzKS5jbG9zZXN0KCdbZGF0YS1kcm9wXScpLnJlbW92ZUNsYXNzKCdkcm9wLW9wZW4nKTtcblx0fSk7XG5cblx0JChkb2N1bWVudCkub24oJ2NsaWNrJywgJ1tkYXRhLWRyb3BdJywgZnVuY3Rpb24oKSB7XG5cblx0XHR2YXIgZGF0YSA9ICQodGhpcykuZGF0YSgnZHJvcCcpO1xuXG5cdFx0aWYgKGRhdGEgPT0gJ3RyaWdnZXInKSB7XG5cdFx0XHQkKCcuZHJvcC1vcGVuJykucmVtb3ZlQ2xhc3MoJ2Ryb3Atb3BlbicpO1xuXHRcdFx0JCh0aGlzKS5wYXJlbnQoKS5jbG9zZXN0KCdbZGF0YS1kcm9wXScpLmFkZENsYXNzKCdkcm9wLW9wZW4nKTtcblx0XHR9IGVsc2UgcmV0dXJuO1xuXG5cdH0pO1xuXG5cdCQoZG9jdW1lbnQpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblxuXHRcdHZhciBkcm9wID0gJChlLnRhcmdldCkucGFyZW50KCkuY2xvc2VzdCgnW2RhdGEtZHJvcF0nKS5nZXQoMCksXG5cdFx0XHRcdHRpcCA9ICQoZS50YXJnZXQpLnBhcmVudCgpLmNsb3Nlc3QoJy50aXAnKS5nZXQoMCk7XG5cblx0XHRpZiAoJChlLnRhcmdldCkuaGFzQ2xhc3MoJ2NvdW50ZXJfX2J0bl9wbHVzJykpIHJldHVybjtcblxuXHRcdGlmICghZHJvcCkge1xuXHRcdFx0JCgnLmRyb3Atb3BlbicpLnJlbW92ZUNsYXNzKCdkcm9wLW9wZW4nKTtcblx0XHR9XG5cblx0XHRpZiAoIXRpcCkge1xuXHRcdFx0JCgnLnRpcF9faGlkZWNvbnRlbnQnKS5oaWRlKCk7XG5cdFx0fVxuXG5cdH0pXG5cblx0JCgnLmRlc2NyaXB0aW9uX19zaG93Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0JCh0aGlzKS5oaWRlKCk7XG5cdFx0JCgnLmRlc2NyaXB0aW9uX19zaG9ydCcpLmhpZGUoKTtcblx0XHQkKCcuZGVzY3JpcHRpb25fX2FsbCcpLnNob3coKTtcblx0fSk7XG5cblx0JCgnW2RhdGEtY2xvc2VdJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0JCh0aGlzKS5wYXJlbnQoKS5oaWRlKCk7XG5cdFx0JCh0aGlzKS5jbG9zZXN0KCcuY2FyZCcpLmNzcygnei1pbmRleCcsICcnKTtcblx0fSk7XG5cblx0JCgnLnRpcF9fbmFtZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdCQoJy5jYXJkJykuY3NzKCd6LWluZGV4JywgJycpO1xuXHRcdCQoJy50aXBfX2hpZGVjb250ZW50JykuaGlkZSgpO1xuXHRcdCQodGhpcykucGFyZW50KCkuZmluZCgnLnRpcF9faGlkZWNvbnRlbnQnKS5zaG93KCk7XG5cdFx0JCh0aGlzKS5jbG9zZXN0KCcuY2FyZCcpLmNzcygnei1pbmRleCcsICcyJyk7XG5cdH0pO1xuXG5cdC8vIEdhbGxlcnlcblx0JCgnLmdhbGxlcnlfX2VsZW1lbnQnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcblxuXHRcdGlmICgkKHRoaXMpLmhhc0NsYXNzKCdnYWxsZXJ5X19lbGVtZW50X3ZpZGVvJykpIHtcblx0XHRcdHZhciB2aWRlbyA9ICQodGhpcykuZmluZCgndmlkZW8nKS5jbG9uZSgpO1xuXG5cdFx0XHQkKCcubW9kYWxfem9vbSAubW9kYWxfX2NvbnRlbnQnKS5odG1sKHZpZGVvKTtcblxuXHRcdFx0JCgnLm1vZGFsX3pvb20nKS5pemlNb2RhbCgnb3BlbicpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR2YXIgaW1nID0gJCh0aGlzKS5maW5kKCdpbWcnKS5jbG9uZSgpO1xuXG5cdFx0XHQkKHRoaXMpLmNsb3Nlc3QoJy5nYWxsZXJ5JykuZmluZCgnLmdhbGxlcnlfX3ZpZXcnKS5lbXB0eSgpLmFwcGVuZChpbWcpO1xuXG5cdFx0XHQkKHRoaXMpLmNsb3Nlc3QoJy5nYWxsZXJ5X19saXN0JykuZmluZCgnLmdhbGxlcnlfX2VsZW1lbnRfYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2dhbGxlcnlfX2VsZW1lbnRfYWN0aXZlJyk7XG5cdFx0XHQkKHRoaXMpLmFkZENsYXNzKCdnYWxsZXJ5X19lbGVtZW50X2FjdGl2ZScpO1xuXHRcdH1cblxuXHR9KTtcblxuXHQkKCcudmxpc3RfZnVsbCcpLmVhY2goZnVuY3Rpb24oaSwgbGlzdCkge1xuXHRcdHZhciBzaG93ID0gJChsaXN0KS5kYXRhKCdzaG93JyksXG5cdFx0XHRcdGxpbmUgPSAkKGxpc3QpLmZpbmQoJy52bGlzdF9fbGluZTpub3QoLnZsaXN0X19saW5lX2hlYWQpJykuZ2V0KHNob3cpO1xuXG5cdFx0JChsaW5lKS5oaWRlKCkubmV4dEFsbCgnOm5vdCgudmxpc3RfX2xpbmVfbW9yZSknKS5oaWRlKCk7XG5cdH0pO1xuXG5cdCQoJy52bGlzdF9fbW9yZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdCQodGhpcykuY2xvc2VzdCgnLnZsaXN0JykudG9nZ2xlQ2xhc3MoJ3ZsaXN0X2FsbHNob3cnKTtcblx0fSk7XG5cblx0aWYgKCQoJ1tkYXRhLW1vZGFsXScpLmdldCgwKSkge1xuXHRcdCQoJ1tkYXRhLW1vZGFsXScpLml6aU1vZGFsKHtcblx0XHRcdHdpZHRoOiAxMTgwXG5cdFx0fSk7XG5cdH1cblxuXG5cdCQoJy5nYWxsZXJ5X192aWV3Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0dmFyIGltZyA9ICQodGhpcykuZmluZCgnaW1nJykuY2xvbmUoKTtcblxuXHRcdCQoJy5tb2RhbF96b29tIC5tb2RhbF9fY29udGVudCcpLmh0bWwoaW1nKVxuXG5cdFx0JCgnLm1vZGFsX3pvb20nKS5pemlNb2RhbCgnb3BlbicpO1xuXHR9KTtcblxuXG5cdCQoJy5maWx0ZXItdG9nZ2xlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0JCgnLmZpbHRlciAudG9nZ2xlOm5vdCgudG9nZ2xlX2Nsb3NlKScpLnRyaWdnZXIoJ2NsaWNrJyk7XG5cdFx0JCgnLmZpbHRlcicpLnRvZ2dsZSgpO1xuXHR9KTtcblxuXHQkKCcubS1tZW51X190b2dnbGUnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHQkKCcubS1tZW51X19jb250ZW50JykudG9nZ2xlKCk7XG5cdH0pO1xuXG5cdCQoJy5tLW1lbnVfX2l0ZW1fZHJvcCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG5cdFx0dmFyIGRyb3AgPSAkKHRoaXMpLmZpbmQoJy5tLW1lbnVfX2Ryb3AnKS5maXJzdCgpO1xuXG5cblx0XHRpZiAoJChlLnRhcmdldCkucGFyZW50c1VudGlsKCcubS1tZW51X19pdGVtX2Ryb3AnKS5sZW5ndGggPD0gMSkge1xuXHRcdFx0JChkcm9wKS50b2dnbGVDbGFzcygnbS1tZW51X19kcm9wX3Nob3cnKTtcblx0XHR9XG5cblx0fSk7XG5cblx0JCgnLm0tbWVudV9fYmFjaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG5cdFx0JCh0aGlzKS5jbG9zZXN0KCcubS1tZW51X19kcm9wX3Nob3cnKS5yZW1vdmVDbGFzcygnbS1tZW51X19kcm9wX3Nob3cnKTtcblx0fSk7XG5cblx0JCgnW2RhdGEtdGFic10gPiAqJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdHZhciBkYXRhID0gJCh0aGlzKS5wYXJlbnQoKS5kYXRhKCd0YWJzJyksXG5cdFx0XHRcdGluZGV4ID0gJCh0aGlzKS5pbmRleCgpLFxuXHRcdFx0XHRjb250ZW50ID0gJCgnW2RhdGEtdGFicy1jb250ZW50PScrZGF0YSsnXScpLmNoaWxkcmVuKCkuZ2V0KGluZGV4KTtcblxuXHRcdCQoY29udGVudCkuc2hvdygpLnNpYmxpbmdzKCkuaGlkZSgpO1xuXG5cdFx0aWYgKCFjb250ZW50KSB7XG5cdFx0XHQkKCdbZGF0YS10YWJzLWNvbnRlbnQ9JytkYXRhKyddJykuY2hpbGRyZW4oKS5oaWRlKCk7XG5cdFx0fVxuXG5cdFx0JCh0aGlzKS5hZGRDbGFzcygnYWN0aXZlJykuc2libGluZ3MoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG5cdH0pO1xuXG5cdGlmICgkKCcubW9kYWxfdmlkZW8nKS5nZXQoMCkpIHtcblx0XHQkKFwiLm1vZGFsX3ZpZGVvXCIpLml6aU1vZGFsKHtcblx0XHRcdGhpc3Rvcnk6IGZhbHNlLFxuXHRcdFx0aWZyYW1lIDogdHJ1ZSxcblx0XHRcdGZ1bGxzY3JlZW46IHRydWUsXG5cdFx0XHRoZWFkZXJDb2xvcjogJyMwMDAwMDAnLFxuXHRcdFx0Z3JvdXA6ICdncm91cDEnLFxuXHRcdFx0bG9vcDogdHJ1ZVxuXHRcdH0pO1xuXHR9XG5cblxuXHQkKCcudmlkZW8nKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHR2YXIgaWQgPSAkKHRoaXMpLmRhdGEoJ2lkJyk7XG5cblx0XHQkKCcjJytpZCkuaXppTW9kYWwoJ29wZW4nKTtcblx0fSk7XG5cblx0JCgnLmNoZWNrYm94IGlucHV0Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cblx0XHQkKHRoaXMpLmNsb3Nlc3QoJy5jaGVja2JveCcpLnRvZ2dsZUNsYXNzKCdjaGVja2JveF9hY3RpdmUnKTtcblx0fSk7XG5cblx0dmFyIHNjcm9sbGluZyxcblx0XHRcdHRvVG9wID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRvLXRvcCcpO1xuXG5cdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGZ1bmN0aW9uKCkge1xuXHRcdCBzY3JvbGxpbmcgPSBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcDtcblxuXHRcdCBpZiAoc2Nyb2xsaW5nID49IDEwMDAgJiYgd2luZG93V2lkdGggPiA5NjApIHtcblx0XHRcdCB0b1RvcC5jbGFzc0xpc3QuYWRkKCd0by10b3Bfc2hvdycpO1xuXHRcdCB9IGVsc2Uge1xuXHRcdFx0IHRvVG9wLmNsYXNzTGlzdC5yZW1vdmUoJ3RvLXRvcF9zaG93Jyk7XG5cdFx0IH1cblx0fSwgdHJ1ZSk7XG5cblx0JCgnLnRvLXRvcCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdCQoXCJodG1sLCBib2R5XCIpLnN0b3AoKS5hbmltYXRlKHtzY3JvbGxUb3A6MH0sIDUwMCwgJ3N3aW5nJyk7XG5cdH0pO1xuXG5cdCQoJy5jb3VudGVyX19idG5fcGx1cycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdCQoJy50aXBfX2hpZGVjb250ZW50JykuaGlkZSgpO1xuXHRcdCQodGhpcykucGFyZW50KCkuZmluZCgnLnRpcF9faGlkZWNvbnRlbnQnKS5maXJzdCgpLnNob3coKTtcblx0fSk7XG5cblx0aW5pdCgpO1xuXG5cbn0pKHdpbmRvdyk7XG4iXX0=
