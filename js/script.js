'use strict';

(function (root) {

	// Инициализация прилдожения
	var windowWidth = $(window).width();

	function init() {

		if ($('.gallery').get(0)) {
			$('.gallery__element').first().trigger('click');
		}

		$('[data-tabs]').each(function (i, tabs) {
			$(tabs).children().first().trigger('click');
		});

		$('.toggle_close').each(function (i, toggle) {
			var data = $(this).data('toggle');

			$(this).parent().find('.' + data).hide();
		});
	};

	$(window).on('resize', function () {
		windowWidth = $(window).width();
	});

	// Слайдеры
	var dataSliders = {
		feautures: {
			items: 6,
			nav: true
		},
		gallery: {
			items: 1,
			nav: true,
			dots: true,
			mouseDrag: false,
			responsive: {
				961: {
					items: 4,
					dots: false
				}
			}
		},
		promo: {
			items: 1,
			dots: true,
			loop: true,
			autoplay: true
		}
	};

	$('[data-slider]').each(function (i, slider) {
		var data = $(this).data('slider');

		$(slider).owlCarousel(dataSliders[data]);
	});

	$('.range__slider').each(function () {
		var range = this,
		    minInput = $(range).closest('.range').find('[data-input="min"]'),
		    maxInput = $(range).closest('.range').find('[data-input="max"]');

		function update() {
			var from = $(range).data('from'),
			    to = $(range).data('to');

			$(minInput).val(from);
			$(maxInput).val(to);
		}

		$(range).ionRangeSlider({
			extra_classes: 'range__slider',
			hide_min_max: true,
			hide_from_to: true
		});

		update();
		$(range).on('change', update);
	});

	$('[data-input]').on('change', function () {
		var range = $(this).closest('.range').find('input.range__slider').data("ionRangeSlider"),
		    val = $(this).val(),
		    min = range.options.min,
		    max = range.options.max,
		    from = range.options.from,
		    to = range.options.to,
		    step = range.options.step;

		switch ($(this).data('input')) {
			case 'min':
				if (val <= min) {
					val = min;
				} else if (val >= max) {
					val = max - step;
				} else if (val >= to) {
					val = to - step;
				}

				range.update({
					from: val
				});
				break;
			case 'max':
				if (val >= max) {
					val = max;
				} else if (val <= min) {
					val = min + step;
				} else if (val <= from) {
					val = from + step;
				}

				range.update({
					to: val
				});
				break;
		}

		$(this).val(val);
	});

	function filled(field) {
		var val = $(field).val().trim();

		if (val.length > 0) {
			$(field).closest('.field').addClass('field_filled');
		} else {
			$(field).closest('.field').removeClass('field_filled');
		}
	}

	$('.field input').each(function () {
		filled(this);
	});

	$('.toggle').on('click', function (e) {
		e.stopPropagation();
		var content = $(this).parent().find($('.' + $(this).data('toggle')));
		$(this).toggleClass('toggle_close');
		$(content).stop().slideToggle(300);
	});

	$('.filter__block-content').each(function (i, block) {
		var checks = $(block).find('.checkbox').length;

		if (checks > 5) {
			$(block).addClass('filter__block-content_more');
			$(block).append('<span class="filter__block-more">Показать все</span>');
		}
	});

	$('.filter__block-more').on('click', function () {
		$(this).parent().removeClass('filter__block-content_more');
		$(this).remove();
	});

	$('.drop__item').on('click', function () {
		if (!$(this).hasClass('drop__item_link')) {
			$(this).addClass('drop__item_active').siblings().removeClass('drop__item_active');
		}

		$(this).closest('[data-drop]').removeClass('drop-open');
	});

	$(document).on('click', '[data-drop]', function () {

		var data = $(this).data('drop');

		if (data == 'trigger') {
			$('.drop-open').removeClass('drop-open');
			$(this).parent().closest('[data-drop]').addClass('drop-open');
		} else return;
	});

	$(document).on('click', function (e) {

		var drop = $(e.target).parent().closest('[data-drop]').get(0),
		    tip = $(e.target).parent().closest('.tip').get(0);

		if ($(e.target).hasClass('counter__btn_plus')) return;

		if (!drop) {
			$('.drop-open').removeClass('drop-open');
		}

		if (!tip) {
			$('.tip__hidecontent').hide();
		}
	});

	$('.description__show').on('click', function () {
		$(this).hide();
		$('.description__short').hide();
		$('.description__all').show();
	});

	$('[data-close]').on('click', function (e) {
		e.preventDefault();

		$(this).parent().hide();
		$(this).closest('.card').css('z-index', '');
	});

	$('.tip__name').on('click', function () {
		$('.card').css('z-index', '');
		$('.tip__hidecontent').hide();
		$(this).parent().find('.tip__hidecontent').show();
		$(this).closest('.card').css('z-index', '2');
	});

	// Gallery
	$('.gallery__element').on('click', function () {

		if ($(this).hasClass('gallery__element_video')) {
			var video = $(this).find('video').clone();

			$('.modal_zoom .modal__content').html(video);

			$('.modal_zoom').iziModal('open');
		} else {
			var img = $(this).find('img').clone();

			$(this).closest('.gallery').find('.gallery__view').empty().append(img);

			$(this).closest('.gallery__list').find('.gallery__element_active').removeClass('gallery__element_active');
			$(this).addClass('gallery__element_active');
		}
	});

	$('.vlist_full').each(function (i, list) {
		var show = $(list).data('show'),
		    line = $(list).find('.vlist__line:not(.vlist__line_head)').get(show);

		$(line).hide().nextAll(':not(.vlist__line_more)').hide();
	});

	$('.vlist__more').on('click', function () {
		$(this).closest('.vlist').toggleClass('vlist_allshow');
	});

	// Modal

	setTimeout(function () {
		$('[data-modal]').iziModal({
			onClosing: function onClosing(r) {
				var video = r.$element.find('video').get(0);

				if (video) {
					video.pause();
				}
			}
		});
	}, 1);

	$('[data-open]').on('click', function (e) {
		e.preventDefault();

		var m = $(this).data('open');
		$('[data-modal=' + m + ']').iziModal('open');
	});

	$('.gallery__view').on('click', function () {
		var img = $(this).find('img').clone();

		$('.modal_zoom .modal__content').html(img);

		$('.modal_zoom').iziModal('open');
	});

	$('.filter-toggle').on('click', function () {
		$('.filter .toggle:not(.toggle_close)').trigger('click');
		$('.filter').toggle();
	});

	$('.m-menu__toggle').on('click', function () {
		$('.m-menu__content').toggle();
	});

	$('.m-menu__item_drop').on('click', function (e) {
		e.stopPropagation();

		var drop = $(this).find('.m-menu__drop').first();

		if ($(e.target).parentsUntil('.m-menu__item_drop').length <= 1) {
			$(drop).toggleClass('m-menu__drop_show');
		}
	});

	$('.m-menu__back').on('click', function (e) {
		e.stopPropagation();

		$(this).closest('.m-menu__drop_show').removeClass('m-menu__drop_show');
	});

	$('[data-tabs] > *').on('click', function (e) {
		e.preventDefault();

		var data = $(this).parent().data('tabs'),
		    index = $(this).index(),
		    content = $('[data-tabs-content=' + data + ']').children().get(index);

		$(content).show().siblings().hide();

		if (!content) {
			$('[data-tabs-content=' + data + ']').children().hide();
		}

		$(this).addClass('active').siblings().removeClass('active');
	});

	// if ($('.modal_video').get(0)) {
	// 	$(".modal_video").iziModal({
	// 		history: false,
	// 		iframe : true,
	// 		fullscreen: true,
	// 		headerColor: '#000000',
	// 		group: 'group1',
	// 		loop: true
	// 	});
	// }


	$('.video').on('click', function () {
		var id = $(this).data('id');

		$('#' + id).iziModal('open');
	});

	$('.checkbox input').on('click', function (e) {
		e.stopPropagation();

		$(this).closest('.checkbox').toggleClass('checkbox_active');
	});

	var scrolling,
	    toTop = document.querySelector('.to-top');

	document.addEventListener('scroll', function () {
		scrolling = document.body.scrollTop;

		if (scrolling >= 1000 && windowWidth > 960) {
			toTop.classList.add('to-top_show');
		} else {
			toTop.classList.remove('to-top_show');
		}
	}, true);

	$('.to-top').on('click', function () {
		$("html, body").stop().animate({ scrollTop: 0 }, 500, 'swing');
	});

	$('.counter__btn_plus').on('click', function (e) {
		e.preventDefault();

		$('.tip__hidecontent').hide();
		$(this).parent().find('.tip__hidecontent').first().show();
	});

	init();

	$('button.btn, .counter__btn, .cart__close, .close').on('click', function (e) {
		e.preventDefault();
	});
})(window);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJyb290Iiwid2luZG93V2lkdGgiLCIkIiwid2luZG93Iiwid2lkdGgiLCJpbml0IiwiZ2V0IiwiZmlyc3QiLCJ0cmlnZ2VyIiwiZWFjaCIsImkiLCJ0YWJzIiwiY2hpbGRyZW4iLCJ0b2dnbGUiLCJkYXRhIiwicGFyZW50IiwiZmluZCIsImhpZGUiLCJvbiIsImRhdGFTbGlkZXJzIiwiZmVhdXR1cmVzIiwiaXRlbXMiLCJuYXYiLCJnYWxsZXJ5IiwiZG90cyIsIm1vdXNlRHJhZyIsInJlc3BvbnNpdmUiLCJwcm9tbyIsImxvb3AiLCJhdXRvcGxheSIsInNsaWRlciIsIm93bENhcm91c2VsIiwicmFuZ2UiLCJtaW5JbnB1dCIsImNsb3Nlc3QiLCJtYXhJbnB1dCIsInVwZGF0ZSIsImZyb20iLCJ0byIsInZhbCIsImlvblJhbmdlU2xpZGVyIiwiZXh0cmFfY2xhc3NlcyIsImhpZGVfbWluX21heCIsImhpZGVfZnJvbV90byIsIm1pbiIsIm9wdGlvbnMiLCJtYXgiLCJzdGVwIiwiZmlsbGVkIiwiZmllbGQiLCJ0cmltIiwibGVuZ3RoIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsImUiLCJzdG9wUHJvcGFnYXRpb24iLCJjb250ZW50IiwidG9nZ2xlQ2xhc3MiLCJzdG9wIiwic2xpZGVUb2dnbGUiLCJibG9jayIsImNoZWNrcyIsImFwcGVuZCIsInJlbW92ZSIsImhhc0NsYXNzIiwic2libGluZ3MiLCJkb2N1bWVudCIsImRyb3AiLCJ0YXJnZXQiLCJ0aXAiLCJzaG93IiwicHJldmVudERlZmF1bHQiLCJjc3MiLCJ2aWRlbyIsImNsb25lIiwiaHRtbCIsIml6aU1vZGFsIiwiaW1nIiwiZW1wdHkiLCJsaXN0IiwibGluZSIsIm5leHRBbGwiLCJzZXRUaW1lb3V0Iiwib25DbG9zaW5nIiwiciIsIiRlbGVtZW50IiwicGF1c2UiLCJtIiwicGFyZW50c1VudGlsIiwiaW5kZXgiLCJpZCIsInNjcm9sbGluZyIsInRvVG9wIiwicXVlcnlTZWxlY3RvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJib2R5Iiwic2Nyb2xsVG9wIiwiY2xhc3NMaXN0IiwiYWRkIiwiYW5pbWF0ZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxDQUFDLFVBQVNBLElBQVQsRUFBZTs7QUFFZjtBQUNBLEtBQUlDLGNBQWNDLEVBQUVDLE1BQUYsRUFBVUMsS0FBVixFQUFsQjs7QUFFQSxVQUFTQyxJQUFULEdBQWdCOztBQUVmLE1BQUlILEVBQUUsVUFBRixFQUFjSSxHQUFkLENBQWtCLENBQWxCLENBQUosRUFBMEI7QUFDekJKLEtBQUUsbUJBQUYsRUFBdUJLLEtBQXZCLEdBQStCQyxPQUEvQixDQUF1QyxPQUF2QztBQUNBOztBQUVETixJQUFFLGFBQUYsRUFBaUJPLElBQWpCLENBQXNCLFVBQVNDLENBQVQsRUFBWUMsSUFBWixFQUFrQjtBQUN2Q1QsS0FBRVMsSUFBRixFQUFRQyxRQUFSLEdBQW1CTCxLQUFuQixHQUEyQkMsT0FBM0IsQ0FBbUMsT0FBbkM7QUFDQSxHQUZEOztBQUlBTixJQUFFLGVBQUYsRUFBbUJPLElBQW5CLENBQXdCLFVBQVNDLENBQVQsRUFBWUcsTUFBWixFQUFvQjtBQUMzQyxPQUFJQyxPQUFPWixFQUFFLElBQUYsRUFBUVksSUFBUixDQUFhLFFBQWIsQ0FBWDs7QUFFQVosS0FBRSxJQUFGLEVBQVFhLE1BQVIsR0FBaUJDLElBQWpCLENBQXNCLE1BQUlGLElBQTFCLEVBQWdDRyxJQUFoQztBQUNBLEdBSkQ7QUFLQTs7QUFFRGYsR0FBRUMsTUFBRixFQUFVZSxFQUFWLENBQWEsUUFBYixFQUF1QixZQUFXO0FBQ2pDakIsZ0JBQWNDLEVBQUVDLE1BQUYsRUFBVUMsS0FBVixFQUFkO0FBQ0EsRUFGRDs7QUFJQTtBQUNBLEtBQUllLGNBQWM7QUFDakJDLGFBQVc7QUFDVkMsVUFBTyxDQURHO0FBRVZDLFFBQUs7QUFGSyxHQURNO0FBS2pCQyxXQUFTO0FBQ1JGLFVBQU8sQ0FEQztBQUVSQyxRQUFLLElBRkc7QUFHUkUsU0FBTSxJQUhFO0FBSVJDLGNBQVcsS0FKSDtBQUtSQyxlQUFZO0FBQ1gsU0FBSztBQUNKTCxZQUFPLENBREg7QUFFSkcsV0FBTTtBQUZGO0FBRE07QUFMSixHQUxRO0FBaUJqQkcsU0FBTztBQUNOTixVQUFPLENBREQ7QUFFTkcsU0FBTSxJQUZBO0FBR05JLFNBQU0sSUFIQTtBQUlOQyxhQUFVO0FBSko7QUFqQlUsRUFBbEI7O0FBeUJBM0IsR0FBRSxlQUFGLEVBQW1CTyxJQUFuQixDQUF3QixVQUFTQyxDQUFULEVBQVlvQixNQUFaLEVBQW9CO0FBQzNDLE1BQUloQixPQUFPWixFQUFFLElBQUYsRUFBUVksSUFBUixDQUFhLFFBQWIsQ0FBWDs7QUFFQVosSUFBRTRCLE1BQUYsRUFBVUMsV0FBVixDQUFzQlosWUFBWUwsSUFBWixDQUF0QjtBQUNBLEVBSkQ7O0FBTUFaLEdBQUUsZ0JBQUYsRUFBb0JPLElBQXBCLENBQXlCLFlBQVc7QUFDbkMsTUFBSXVCLFFBQVEsSUFBWjtBQUFBLE1BQ0VDLFdBQVcvQixFQUFFOEIsS0FBRixFQUFTRSxPQUFULENBQWlCLFFBQWpCLEVBQTJCbEIsSUFBM0IsQ0FBZ0Msb0JBQWhDLENBRGI7QUFBQSxNQUVFbUIsV0FBV2pDLEVBQUU4QixLQUFGLEVBQVNFLE9BQVQsQ0FBaUIsUUFBakIsRUFBMkJsQixJQUEzQixDQUFnQyxvQkFBaEMsQ0FGYjs7QUFJQSxXQUFTb0IsTUFBVCxHQUFrQjtBQUNqQixPQUFJQyxPQUFPbkMsRUFBRThCLEtBQUYsRUFBU2xCLElBQVQsQ0FBYyxNQUFkLENBQVg7QUFBQSxPQUNFd0IsS0FBS3BDLEVBQUU4QixLQUFGLEVBQVNsQixJQUFULENBQWMsSUFBZCxDQURQOztBQUdBWixLQUFFK0IsUUFBRixFQUFZTSxHQUFaLENBQWdCRixJQUFoQjtBQUNBbkMsS0FBRWlDLFFBQUYsRUFBWUksR0FBWixDQUFnQkQsRUFBaEI7QUFDQTs7QUFFRHBDLElBQUU4QixLQUFGLEVBQVNRLGNBQVQsQ0FBd0I7QUFDdkJDLGtCQUFlLGVBRFE7QUFFdkJDLGlCQUFjLElBRlM7QUFHdkJDLGlCQUFjO0FBSFMsR0FBeEI7O0FBTUFQO0FBQ0FsQyxJQUFFOEIsS0FBRixFQUFTZCxFQUFULENBQVksUUFBWixFQUFzQmtCLE1BQXRCO0FBQ0EsRUFyQkQ7O0FBdUJBbEMsR0FBRSxjQUFGLEVBQWtCZ0IsRUFBbEIsQ0FBcUIsUUFBckIsRUFBK0IsWUFBVztBQUN6QyxNQUFJYyxRQUFROUIsRUFBRSxJQUFGLEVBQVFnQyxPQUFSLENBQWdCLFFBQWhCLEVBQTBCbEIsSUFBMUIsQ0FBK0IscUJBQS9CLEVBQXNERixJQUF0RCxDQUEyRCxnQkFBM0QsQ0FBWjtBQUFBLE1BQ0V5QixNQUFNckMsRUFBRSxJQUFGLEVBQVFxQyxHQUFSLEVBRFI7QUFBQSxNQUVFSyxNQUFNWixNQUFNYSxPQUFOLENBQWNELEdBRnRCO0FBQUEsTUFHRUUsTUFBTWQsTUFBTWEsT0FBTixDQUFjQyxHQUh0QjtBQUFBLE1BSUVULE9BQU9MLE1BQU1hLE9BQU4sQ0FBY1IsSUFKdkI7QUFBQSxNQUtFQyxLQUFLTixNQUFNYSxPQUFOLENBQWNQLEVBTHJCO0FBQUEsTUFNRVMsT0FBT2YsTUFBTWEsT0FBTixDQUFjRSxJQU52Qjs7QUFRQSxVQUFRN0MsRUFBRSxJQUFGLEVBQVFZLElBQVIsQ0FBYSxPQUFiLENBQVI7QUFDQyxRQUFLLEtBQUw7QUFDQyxRQUFJeUIsT0FBT0ssR0FBWCxFQUFnQjtBQUNmTCxXQUFNSyxHQUFOO0FBQ0EsS0FGRCxNQUVPLElBQUlMLE9BQU9PLEdBQVgsRUFBZ0I7QUFDdEJQLFdBQU1PLE1BQU1DLElBQVo7QUFDQSxLQUZNLE1BRUEsSUFBSVIsT0FBT0QsRUFBWCxFQUFlO0FBQ3JCQyxXQUFNRCxLQUFLUyxJQUFYO0FBQ0E7O0FBRURmLFVBQU1JLE1BQU4sQ0FBYTtBQUNaQyxXQUFNRTtBQURNLEtBQWI7QUFHQTtBQUNELFFBQUssS0FBTDtBQUNDLFFBQUlBLE9BQU9PLEdBQVgsRUFBZ0I7QUFDZlAsV0FBTU8sR0FBTjtBQUNBLEtBRkQsTUFFTyxJQUFJUCxPQUFPSyxHQUFYLEVBQWdCO0FBQ3RCTCxXQUFNSyxNQUFNRyxJQUFaO0FBQ0EsS0FGTSxNQUVBLElBQUlSLE9BQU9GLElBQVgsRUFBaUI7QUFDdkJFLFdBQU1GLE9BQU9VLElBQWI7QUFDQTs7QUFFRGYsVUFBTUksTUFBTixDQUFhO0FBQ1pFLFNBQUlDO0FBRFEsS0FBYjtBQUdBO0FBMUJGOztBQTZCQXJDLElBQUUsSUFBRixFQUFRcUMsR0FBUixDQUFZQSxHQUFaO0FBRUEsRUF4Q0Q7O0FBMENBLFVBQVNTLE1BQVQsQ0FBZ0JDLEtBQWhCLEVBQXVCO0FBQ3RCLE1BQUlWLE1BQU1yQyxFQUFFK0MsS0FBRixFQUFTVixHQUFULEdBQWVXLElBQWYsRUFBVjs7QUFFQSxNQUFJWCxJQUFJWSxNQUFKLEdBQWEsQ0FBakIsRUFBb0I7QUFDbkJqRCxLQUFFK0MsS0FBRixFQUFTZixPQUFULENBQWlCLFFBQWpCLEVBQTJCa0IsUUFBM0IsQ0FBb0MsY0FBcEM7QUFDQSxHQUZELE1BRU87QUFDTmxELEtBQUUrQyxLQUFGLEVBQVNmLE9BQVQsQ0FBaUIsUUFBakIsRUFBMkJtQixXQUEzQixDQUF1QyxjQUF2QztBQUNBO0FBQ0Q7O0FBRURuRCxHQUFFLGNBQUYsRUFBa0JPLElBQWxCLENBQXVCLFlBQVc7QUFDakN1QyxTQUFPLElBQVA7QUFDQSxFQUZEOztBQUlBOUMsR0FBRSxTQUFGLEVBQWFnQixFQUFiLENBQWdCLE9BQWhCLEVBQXlCLFVBQVNvQyxDQUFULEVBQVk7QUFDcENBLElBQUVDLGVBQUY7QUFDQSxNQUFJQyxVQUFVdEQsRUFBRSxJQUFGLEVBQVFhLE1BQVIsR0FBaUJDLElBQWpCLENBQXNCZCxFQUFFLE1BQUlBLEVBQUUsSUFBRixFQUFRWSxJQUFSLENBQWEsUUFBYixDQUFOLENBQXRCLENBQWQ7QUFDQVosSUFBRSxJQUFGLEVBQVF1RCxXQUFSLENBQW9CLGNBQXBCO0FBQ0F2RCxJQUFFc0QsT0FBRixFQUFXRSxJQUFYLEdBQWtCQyxXQUFsQixDQUE4QixHQUE5QjtBQUNBLEVBTEQ7O0FBT0F6RCxHQUFFLHdCQUFGLEVBQTRCTyxJQUE1QixDQUFpQyxVQUFTQyxDQUFULEVBQVlrRCxLQUFaLEVBQW1CO0FBQ25ELE1BQUlDLFNBQVMzRCxFQUFFMEQsS0FBRixFQUFTNUMsSUFBVCxDQUFjLFdBQWQsRUFBMkJtQyxNQUF4Qzs7QUFFQSxNQUFJVSxTQUFTLENBQWIsRUFBZ0I7QUFDZjNELEtBQUUwRCxLQUFGLEVBQVNSLFFBQVQsQ0FBa0IsNEJBQWxCO0FBQ0FsRCxLQUFFMEQsS0FBRixFQUFTRSxNQUFULENBQWdCLHNEQUFoQjtBQUNBO0FBQ0QsRUFQRDs7QUFTQTVELEdBQUUscUJBQUYsRUFBeUJnQixFQUF6QixDQUE0QixPQUE1QixFQUFxQyxZQUFXO0FBQy9DaEIsSUFBRSxJQUFGLEVBQVFhLE1BQVIsR0FBaUJzQyxXQUFqQixDQUE2Qiw0QkFBN0I7QUFDQW5ELElBQUUsSUFBRixFQUFRNkQsTUFBUjtBQUNBLEVBSEQ7O0FBS0E3RCxHQUFFLGFBQUYsRUFBaUJnQixFQUFqQixDQUFvQixPQUFwQixFQUE2QixZQUFXO0FBQ3ZDLE1BQUksQ0FBQ2hCLEVBQUUsSUFBRixFQUFROEQsUUFBUixDQUFpQixpQkFBakIsQ0FBTCxFQUEwQztBQUN6QzlELEtBQUUsSUFBRixFQUFRa0QsUUFBUixDQUFpQixtQkFBakIsRUFBc0NhLFFBQXRDLEdBQWlEWixXQUFqRCxDQUE2RCxtQkFBN0Q7QUFDQTs7QUFFRG5ELElBQUUsSUFBRixFQUFRZ0MsT0FBUixDQUFnQixhQUFoQixFQUErQm1CLFdBQS9CLENBQTJDLFdBQTNDO0FBQ0EsRUFORDs7QUFRQW5ELEdBQUVnRSxRQUFGLEVBQVloRCxFQUFaLENBQWUsT0FBZixFQUF3QixhQUF4QixFQUF1QyxZQUFXOztBQUVqRCxNQUFJSixPQUFPWixFQUFFLElBQUYsRUFBUVksSUFBUixDQUFhLE1BQWIsQ0FBWDs7QUFFQSxNQUFJQSxRQUFRLFNBQVosRUFBdUI7QUFDdEJaLEtBQUUsWUFBRixFQUFnQm1ELFdBQWhCLENBQTRCLFdBQTVCO0FBQ0FuRCxLQUFFLElBQUYsRUFBUWEsTUFBUixHQUFpQm1CLE9BQWpCLENBQXlCLGFBQXpCLEVBQXdDa0IsUUFBeEMsQ0FBaUQsV0FBakQ7QUFDQSxHQUhELE1BR087QUFFUCxFQVREOztBQVdBbEQsR0FBRWdFLFFBQUYsRUFBWWhELEVBQVosQ0FBZSxPQUFmLEVBQXdCLFVBQVNvQyxDQUFULEVBQVk7O0FBRW5DLE1BQUlhLE9BQU9qRSxFQUFFb0QsRUFBRWMsTUFBSixFQUFZckQsTUFBWixHQUFxQm1CLE9BQXJCLENBQTZCLGFBQTdCLEVBQTRDNUIsR0FBNUMsQ0FBZ0QsQ0FBaEQsQ0FBWDtBQUFBLE1BQ0UrRCxNQUFNbkUsRUFBRW9ELEVBQUVjLE1BQUosRUFBWXJELE1BQVosR0FBcUJtQixPQUFyQixDQUE2QixNQUE3QixFQUFxQzVCLEdBQXJDLENBQXlDLENBQXpDLENBRFI7O0FBR0EsTUFBSUosRUFBRW9ELEVBQUVjLE1BQUosRUFBWUosUUFBWixDQUFxQixtQkFBckIsQ0FBSixFQUErQzs7QUFFL0MsTUFBSSxDQUFDRyxJQUFMLEVBQVc7QUFDVmpFLEtBQUUsWUFBRixFQUFnQm1ELFdBQWhCLENBQTRCLFdBQTVCO0FBQ0E7O0FBRUQsTUFBSSxDQUFDZ0IsR0FBTCxFQUFVO0FBQ1RuRSxLQUFFLG1CQUFGLEVBQXVCZSxJQUF2QjtBQUNBO0FBRUQsRUFmRDs7QUFpQkFmLEdBQUUsb0JBQUYsRUFBd0JnQixFQUF4QixDQUEyQixPQUEzQixFQUFvQyxZQUFXO0FBQzlDaEIsSUFBRSxJQUFGLEVBQVFlLElBQVI7QUFDQWYsSUFBRSxxQkFBRixFQUF5QmUsSUFBekI7QUFDQWYsSUFBRSxtQkFBRixFQUF1Qm9FLElBQXZCO0FBQ0EsRUFKRDs7QUFNQXBFLEdBQUUsY0FBRixFQUFrQmdCLEVBQWxCLENBQXFCLE9BQXJCLEVBQThCLFVBQVNvQyxDQUFULEVBQVk7QUFDekNBLElBQUVpQixjQUFGOztBQUVBckUsSUFBRSxJQUFGLEVBQVFhLE1BQVIsR0FBaUJFLElBQWpCO0FBQ0FmLElBQUUsSUFBRixFQUFRZ0MsT0FBUixDQUFnQixPQUFoQixFQUF5QnNDLEdBQXpCLENBQTZCLFNBQTdCLEVBQXdDLEVBQXhDO0FBQ0EsRUFMRDs7QUFPQXRFLEdBQUUsWUFBRixFQUFnQmdCLEVBQWhCLENBQW1CLE9BQW5CLEVBQTRCLFlBQVc7QUFDdENoQixJQUFFLE9BQUYsRUFBV3NFLEdBQVgsQ0FBZSxTQUFmLEVBQTBCLEVBQTFCO0FBQ0F0RSxJQUFFLG1CQUFGLEVBQXVCZSxJQUF2QjtBQUNBZixJQUFFLElBQUYsRUFBUWEsTUFBUixHQUFpQkMsSUFBakIsQ0FBc0IsbUJBQXRCLEVBQTJDc0QsSUFBM0M7QUFDQXBFLElBQUUsSUFBRixFQUFRZ0MsT0FBUixDQUFnQixPQUFoQixFQUF5QnNDLEdBQXpCLENBQTZCLFNBQTdCLEVBQXdDLEdBQXhDO0FBQ0EsRUFMRDs7QUFPQTtBQUNBdEUsR0FBRSxtQkFBRixFQUF1QmdCLEVBQXZCLENBQTBCLE9BQTFCLEVBQW1DLFlBQVc7O0FBRTdDLE1BQUloQixFQUFFLElBQUYsRUFBUThELFFBQVIsQ0FBaUIsd0JBQWpCLENBQUosRUFBZ0Q7QUFDL0MsT0FBSVMsUUFBUXZFLEVBQUUsSUFBRixFQUFRYyxJQUFSLENBQWEsT0FBYixFQUFzQjBELEtBQXRCLEVBQVo7O0FBRUF4RSxLQUFFLDZCQUFGLEVBQWlDeUUsSUFBakMsQ0FBc0NGLEtBQXRDOztBQUVBdkUsS0FBRSxhQUFGLEVBQWlCMEUsUUFBakIsQ0FBMEIsTUFBMUI7QUFFQSxHQVBELE1BT087QUFDTixPQUFJQyxNQUFNM0UsRUFBRSxJQUFGLEVBQVFjLElBQVIsQ0FBYSxLQUFiLEVBQW9CMEQsS0FBcEIsRUFBVjs7QUFFQXhFLEtBQUUsSUFBRixFQUFRZ0MsT0FBUixDQUFnQixVQUFoQixFQUE0QmxCLElBQTVCLENBQWlDLGdCQUFqQyxFQUFtRDhELEtBQW5ELEdBQTJEaEIsTUFBM0QsQ0FBa0VlLEdBQWxFOztBQUVBM0UsS0FBRSxJQUFGLEVBQVFnQyxPQUFSLENBQWdCLGdCQUFoQixFQUFrQ2xCLElBQWxDLENBQXVDLDBCQUF2QyxFQUFtRXFDLFdBQW5FLENBQStFLHlCQUEvRTtBQUNBbkQsS0FBRSxJQUFGLEVBQVFrRCxRQUFSLENBQWlCLHlCQUFqQjtBQUNBO0FBRUQsRUFsQkQ7O0FBb0JBbEQsR0FBRSxhQUFGLEVBQWlCTyxJQUFqQixDQUFzQixVQUFTQyxDQUFULEVBQVlxRSxJQUFaLEVBQWtCO0FBQ3ZDLE1BQUlULE9BQU9wRSxFQUFFNkUsSUFBRixFQUFRakUsSUFBUixDQUFhLE1BQWIsQ0FBWDtBQUFBLE1BQ0VrRSxPQUFPOUUsRUFBRTZFLElBQUYsRUFBUS9ELElBQVIsQ0FBYSxxQ0FBYixFQUFvRFYsR0FBcEQsQ0FBd0RnRSxJQUF4RCxDQURUOztBQUdBcEUsSUFBRThFLElBQUYsRUFBUS9ELElBQVIsR0FBZWdFLE9BQWYsQ0FBdUIseUJBQXZCLEVBQWtEaEUsSUFBbEQ7QUFDQSxFQUxEOztBQU9BZixHQUFFLGNBQUYsRUFBa0JnQixFQUFsQixDQUFxQixPQUFyQixFQUE4QixZQUFXO0FBQ3hDaEIsSUFBRSxJQUFGLEVBQVFnQyxPQUFSLENBQWdCLFFBQWhCLEVBQTBCdUIsV0FBMUIsQ0FBc0MsZUFBdEM7QUFDQSxFQUZEOztBQUlBOztBQUVBeUIsWUFBVyxZQUFXO0FBQ3JCaEYsSUFBRSxjQUFGLEVBQWtCMEUsUUFBbEIsQ0FBMkI7QUFDMUJPLGNBQVcsbUJBQVNDLENBQVQsRUFBVztBQUNyQixRQUFJWCxRQUFRVyxFQUFFQyxRQUFGLENBQVdyRSxJQUFYLENBQWdCLE9BQWhCLEVBQXlCVixHQUF6QixDQUE2QixDQUE3QixDQUFaOztBQUVBLFFBQUltRSxLQUFKLEVBQVc7QUFDVkEsV0FBTWEsS0FBTjtBQUNBO0FBQ0Q7QUFQeUIsR0FBM0I7QUFTQSxFQVZELEVBVUcsQ0FWSDs7QUFhQXBGLEdBQUUsYUFBRixFQUFpQmdCLEVBQWpCLENBQW9CLE9BQXBCLEVBQTZCLFVBQVNvQyxDQUFULEVBQVk7QUFDeENBLElBQUVpQixjQUFGOztBQUVBLE1BQUlnQixJQUFJckYsRUFBRSxJQUFGLEVBQVFZLElBQVIsQ0FBYSxNQUFiLENBQVI7QUFDQVosSUFBRSxpQkFBZXFGLENBQWYsR0FBaUIsR0FBbkIsRUFBd0JYLFFBQXhCLENBQWlDLE1BQWpDO0FBQ0EsRUFMRDs7QUFRQTFFLEdBQUUsZ0JBQUYsRUFBb0JnQixFQUFwQixDQUF1QixPQUF2QixFQUFnQyxZQUFXO0FBQzFDLE1BQUkyRCxNQUFNM0UsRUFBRSxJQUFGLEVBQVFjLElBQVIsQ0FBYSxLQUFiLEVBQW9CMEQsS0FBcEIsRUFBVjs7QUFFQXhFLElBQUUsNkJBQUYsRUFBaUN5RSxJQUFqQyxDQUFzQ0UsR0FBdEM7O0FBRUEzRSxJQUFFLGFBQUYsRUFBaUIwRSxRQUFqQixDQUEwQixNQUExQjtBQUNBLEVBTkQ7O0FBU0ExRSxHQUFFLGdCQUFGLEVBQW9CZ0IsRUFBcEIsQ0FBdUIsT0FBdkIsRUFBZ0MsWUFBVztBQUMxQ2hCLElBQUUsb0NBQUYsRUFBd0NNLE9BQXhDLENBQWdELE9BQWhEO0FBQ0FOLElBQUUsU0FBRixFQUFhVyxNQUFiO0FBQ0EsRUFIRDs7QUFLQVgsR0FBRSxpQkFBRixFQUFxQmdCLEVBQXJCLENBQXdCLE9BQXhCLEVBQWlDLFlBQVc7QUFDM0NoQixJQUFFLGtCQUFGLEVBQXNCVyxNQUF0QjtBQUNBLEVBRkQ7O0FBSUFYLEdBQUUsb0JBQUYsRUFBd0JnQixFQUF4QixDQUEyQixPQUEzQixFQUFvQyxVQUFTb0MsQ0FBVCxFQUFZO0FBQy9DQSxJQUFFQyxlQUFGOztBQUVBLE1BQUlZLE9BQU9qRSxFQUFFLElBQUYsRUFBUWMsSUFBUixDQUFhLGVBQWIsRUFBOEJULEtBQTlCLEVBQVg7O0FBR0EsTUFBSUwsRUFBRW9ELEVBQUVjLE1BQUosRUFBWW9CLFlBQVosQ0FBeUIsb0JBQXpCLEVBQStDckMsTUFBL0MsSUFBeUQsQ0FBN0QsRUFBZ0U7QUFDL0RqRCxLQUFFaUUsSUFBRixFQUFRVixXQUFSLENBQW9CLG1CQUFwQjtBQUNBO0FBRUQsRUFWRDs7QUFZQXZELEdBQUUsZUFBRixFQUFtQmdCLEVBQW5CLENBQXNCLE9BQXRCLEVBQStCLFVBQVNvQyxDQUFULEVBQVk7QUFDMUNBLElBQUVDLGVBQUY7O0FBRUFyRCxJQUFFLElBQUYsRUFBUWdDLE9BQVIsQ0FBZ0Isb0JBQWhCLEVBQXNDbUIsV0FBdEMsQ0FBa0QsbUJBQWxEO0FBQ0EsRUFKRDs7QUFNQW5ELEdBQUUsaUJBQUYsRUFBcUJnQixFQUFyQixDQUF3QixPQUF4QixFQUFpQyxVQUFTb0MsQ0FBVCxFQUFZO0FBQzVDQSxJQUFFaUIsY0FBRjs7QUFFQSxNQUFJekQsT0FBT1osRUFBRSxJQUFGLEVBQVFhLE1BQVIsR0FBaUJELElBQWpCLENBQXNCLE1BQXRCLENBQVg7QUFBQSxNQUNFMkUsUUFBUXZGLEVBQUUsSUFBRixFQUFRdUYsS0FBUixFQURWO0FBQUEsTUFFRWpDLFVBQVV0RCxFQUFFLHdCQUFzQlksSUFBdEIsR0FBMkIsR0FBN0IsRUFBa0NGLFFBQWxDLEdBQTZDTixHQUE3QyxDQUFpRG1GLEtBQWpELENBRlo7O0FBSUF2RixJQUFFc0QsT0FBRixFQUFXYyxJQUFYLEdBQWtCTCxRQUFsQixHQUE2QmhELElBQTdCOztBQUVBLE1BQUksQ0FBQ3VDLE9BQUwsRUFBYztBQUNidEQsS0FBRSx3QkFBc0JZLElBQXRCLEdBQTJCLEdBQTdCLEVBQWtDRixRQUFsQyxHQUE2Q0ssSUFBN0M7QUFDQTs7QUFFRGYsSUFBRSxJQUFGLEVBQVFrRCxRQUFSLENBQWlCLFFBQWpCLEVBQTJCYSxRQUEzQixHQUFzQ1osV0FBdEMsQ0FBa0QsUUFBbEQ7QUFDQSxFQWREOztBQWdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0FuRCxHQUFFLFFBQUYsRUFBWWdCLEVBQVosQ0FBZSxPQUFmLEVBQXdCLFlBQVc7QUFDbEMsTUFBSXdFLEtBQUt4RixFQUFFLElBQUYsRUFBUVksSUFBUixDQUFhLElBQWIsQ0FBVDs7QUFFQVosSUFBRSxNQUFJd0YsRUFBTixFQUFVZCxRQUFWLENBQW1CLE1BQW5CO0FBQ0EsRUFKRDs7QUFNQTFFLEdBQUUsaUJBQUYsRUFBcUJnQixFQUFyQixDQUF3QixPQUF4QixFQUFpQyxVQUFTb0MsQ0FBVCxFQUFZO0FBQzVDQSxJQUFFQyxlQUFGOztBQUVBckQsSUFBRSxJQUFGLEVBQVFnQyxPQUFSLENBQWdCLFdBQWhCLEVBQTZCdUIsV0FBN0IsQ0FBeUMsaUJBQXpDO0FBQ0EsRUFKRDs7QUFNQSxLQUFJa0MsU0FBSjtBQUFBLEtBQ0VDLFFBQVExQixTQUFTMkIsYUFBVCxDQUF1QixTQUF2QixDQURWOztBQUdBM0IsVUFBUzRCLGdCQUFULENBQTBCLFFBQTFCLEVBQW9DLFlBQVc7QUFDN0NILGNBQVl6QixTQUFTNkIsSUFBVCxDQUFjQyxTQUExQjs7QUFFQSxNQUFJTCxhQUFhLElBQWIsSUFBcUIxRixjQUFjLEdBQXZDLEVBQTRDO0FBQzNDMkYsU0FBTUssU0FBTixDQUFnQkMsR0FBaEIsQ0FBb0IsYUFBcEI7QUFDQSxHQUZELE1BRU87QUFDTk4sU0FBTUssU0FBTixDQUFnQmxDLE1BQWhCLENBQXVCLGFBQXZCO0FBQ0E7QUFDRixFQVJELEVBUUcsSUFSSDs7QUFVQTdELEdBQUUsU0FBRixFQUFhZ0IsRUFBYixDQUFnQixPQUFoQixFQUF5QixZQUFXO0FBQ25DaEIsSUFBRSxZQUFGLEVBQWdCd0QsSUFBaEIsR0FBdUJ5QyxPQUF2QixDQUErQixFQUFDSCxXQUFVLENBQVgsRUFBL0IsRUFBOEMsR0FBOUMsRUFBbUQsT0FBbkQ7QUFDQSxFQUZEOztBQUlBOUYsR0FBRSxvQkFBRixFQUF3QmdCLEVBQXhCLENBQTJCLE9BQTNCLEVBQW9DLFVBQVNvQyxDQUFULEVBQVk7QUFDL0NBLElBQUVpQixjQUFGOztBQUVBckUsSUFBRSxtQkFBRixFQUF1QmUsSUFBdkI7QUFDQWYsSUFBRSxJQUFGLEVBQVFhLE1BQVIsR0FBaUJDLElBQWpCLENBQXNCLG1CQUF0QixFQUEyQ1QsS0FBM0MsR0FBbUQrRCxJQUFuRDtBQUNBLEVBTEQ7O0FBT0FqRTs7QUFFQUgsR0FBRSxpREFBRixFQUFxRGdCLEVBQXJELENBQXdELE9BQXhELEVBQWlFLFVBQVNvQyxDQUFULEVBQVk7QUFDNUVBLElBQUVpQixjQUFGO0FBQ0EsRUFGRDtBQUtBLENBeFhELEVBd1hHcEUsTUF4WEgiLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKHJvb3QpIHtcblxuXHQvLyDQmNC90LjRhtC40LDQu9C40LfQsNGG0LjRjyDQv9GA0LjQu9C00L7QttC10L3QuNGPXG5cdHZhciB3aW5kb3dXaWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xuXG5cdGZ1bmN0aW9uIGluaXQoKSB7XG5cblx0XHRpZiAoJCgnLmdhbGxlcnknKS5nZXQoMCkpIHtcblx0XHRcdCQoJy5nYWxsZXJ5X19lbGVtZW50JykuZmlyc3QoKS50cmlnZ2VyKCdjbGljaycpO1xuXHRcdH1cblxuXHRcdCQoJ1tkYXRhLXRhYnNdJykuZWFjaChmdW5jdGlvbihpLCB0YWJzKSB7XG5cdFx0XHQkKHRhYnMpLmNoaWxkcmVuKCkuZmlyc3QoKS50cmlnZ2VyKCdjbGljaycpO1xuXHRcdH0pO1xuXG5cdFx0JCgnLnRvZ2dsZV9jbG9zZScpLmVhY2goZnVuY3Rpb24oaSwgdG9nZ2xlKSB7XG5cdFx0XHR2YXIgZGF0YSA9ICQodGhpcykuZGF0YSgndG9nZ2xlJyk7XG5cblx0XHRcdCQodGhpcykucGFyZW50KCkuZmluZCgnLicrZGF0YSkuaGlkZSgpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdCQod2luZG93KS5vbigncmVzaXplJywgZnVuY3Rpb24oKSB7XG5cdFx0d2luZG93V2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTtcblx0fSk7XG5cblx0Ly8g0KHQu9Cw0LnQtNC10YDRi1xuXHR2YXIgZGF0YVNsaWRlcnMgPSB7XG5cdFx0ZmVhdXR1cmVzOiB7XG5cdFx0XHRpdGVtczogNixcblx0XHRcdG5hdjogdHJ1ZVxuXHRcdH0sXG5cdFx0Z2FsbGVyeToge1xuXHRcdFx0aXRlbXM6IDEsXG5cdFx0XHRuYXY6IHRydWUsXG5cdFx0XHRkb3RzOiB0cnVlLFxuXHRcdFx0bW91c2VEcmFnOiBmYWxzZSxcblx0XHRcdHJlc3BvbnNpdmU6IHtcblx0XHRcdFx0OTYxOiB7XG5cdFx0XHRcdFx0aXRlbXM6IDQsXG5cdFx0XHRcdFx0ZG90czogZmFsc2Vcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cdFx0cHJvbW86IHtcblx0XHRcdGl0ZW1zOiAxLFxuXHRcdFx0ZG90czogdHJ1ZSxcblx0XHRcdGxvb3A6IHRydWUsXG5cdFx0XHRhdXRvcGxheTogdHJ1ZSxcblx0XHR9XG5cdH1cblxuXHQkKCdbZGF0YS1zbGlkZXJdJykuZWFjaChmdW5jdGlvbihpLCBzbGlkZXIpIHtcblx0XHR2YXIgZGF0YSA9ICQodGhpcykuZGF0YSgnc2xpZGVyJyk7XG5cblx0XHQkKHNsaWRlcikub3dsQ2Fyb3VzZWwoZGF0YVNsaWRlcnNbZGF0YV0pXG5cdH0pO1xuXG5cdCQoJy5yYW5nZV9fc2xpZGVyJykuZWFjaChmdW5jdGlvbigpIHtcblx0XHR2YXIgcmFuZ2UgPSB0aGlzLFxuXHRcdFx0XHRtaW5JbnB1dCA9ICQocmFuZ2UpLmNsb3Nlc3QoJy5yYW5nZScpLmZpbmQoJ1tkYXRhLWlucHV0PVwibWluXCJdJyksXG5cdFx0XHRcdG1heElucHV0ID0gJChyYW5nZSkuY2xvc2VzdCgnLnJhbmdlJykuZmluZCgnW2RhdGEtaW5wdXQ9XCJtYXhcIl0nKTtcblxuXHRcdGZ1bmN0aW9uIHVwZGF0ZSgpIHtcblx0XHRcdHZhciBmcm9tID0gJChyYW5nZSkuZGF0YSgnZnJvbScpLFxuXHRcdFx0XHRcdHRvID0gJChyYW5nZSkuZGF0YSgndG8nKTtcblxuXHRcdFx0JChtaW5JbnB1dCkudmFsKGZyb20pO1xuXHRcdFx0JChtYXhJbnB1dCkudmFsKHRvKTtcblx0XHR9XG5cblx0XHQkKHJhbmdlKS5pb25SYW5nZVNsaWRlcih7XG5cdFx0XHRleHRyYV9jbGFzc2VzOiAncmFuZ2VfX3NsaWRlcicsXG5cdFx0XHRoaWRlX21pbl9tYXg6IHRydWUsXG5cdFx0XHRoaWRlX2Zyb21fdG86IHRydWUsXG5cdFx0fSk7XG5cblx0XHR1cGRhdGUoKTtcblx0XHQkKHJhbmdlKS5vbignY2hhbmdlJywgdXBkYXRlKTtcblx0fSk7XG5cblx0JCgnW2RhdGEtaW5wdXRdJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCkge1xuXHRcdHZhciByYW5nZSA9ICQodGhpcykuY2xvc2VzdCgnLnJhbmdlJykuZmluZCgnaW5wdXQucmFuZ2VfX3NsaWRlcicpLmRhdGEoXCJpb25SYW5nZVNsaWRlclwiKSxcblx0XHRcdFx0dmFsID0gJCh0aGlzKS52YWwoKSxcblx0XHRcdFx0bWluID0gcmFuZ2Uub3B0aW9ucy5taW4sXG5cdFx0XHRcdG1heCA9IHJhbmdlLm9wdGlvbnMubWF4LFxuXHRcdFx0XHRmcm9tID0gcmFuZ2Uub3B0aW9ucy5mcm9tLFxuXHRcdFx0XHR0byA9IHJhbmdlLm9wdGlvbnMudG8sXG5cdFx0XHRcdHN0ZXAgPSByYW5nZS5vcHRpb25zLnN0ZXA7XG5cblx0XHRzd2l0Y2ggKCQodGhpcykuZGF0YSgnaW5wdXQnKSkge1xuXHRcdFx0Y2FzZSAnbWluJzpcblx0XHRcdFx0aWYgKHZhbCA8PSBtaW4pIHtcblx0XHRcdFx0XHR2YWwgPSBtaW47XG5cdFx0XHRcdH0gZWxzZSBpZiAodmFsID49IG1heCkge1xuXHRcdFx0XHRcdHZhbCA9IG1heCAtIHN0ZXA7XG5cdFx0XHRcdH0gZWxzZSBpZiAodmFsID49IHRvKSB7XG5cdFx0XHRcdFx0dmFsID0gdG8gLSBzdGVwO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmFuZ2UudXBkYXRlKHtcblx0XHRcdFx0XHRmcm9tOiB2YWxcblx0XHRcdFx0fSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnbWF4Jzpcblx0XHRcdFx0aWYgKHZhbCA+PSBtYXgpIHtcblx0XHRcdFx0XHR2YWwgPSBtYXg7XG5cdFx0XHRcdH0gZWxzZSBpZiAodmFsIDw9IG1pbikge1xuXHRcdFx0XHRcdHZhbCA9IG1pbiArIHN0ZXA7XG5cdFx0XHRcdH0gZWxzZSBpZiAodmFsIDw9IGZyb20pIHtcblx0XHRcdFx0XHR2YWwgPSBmcm9tICsgc3RlcDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJhbmdlLnVwZGF0ZSh7XG5cdFx0XHRcdFx0dG86IHZhbFxuXHRcdFx0XHR9KTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXG5cdFx0JCh0aGlzKS52YWwodmFsKTtcblxuXHR9KTtcblxuXHRmdW5jdGlvbiBmaWxsZWQoZmllbGQpIHtcblx0XHR2YXIgdmFsID0gJChmaWVsZCkudmFsKCkudHJpbSgpO1xuXG5cdFx0aWYgKHZhbC5sZW5ndGggPiAwKSB7XG5cdFx0XHQkKGZpZWxkKS5jbG9zZXN0KCcuZmllbGQnKS5hZGRDbGFzcygnZmllbGRfZmlsbGVkJyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdCQoZmllbGQpLmNsb3Nlc3QoJy5maWVsZCcpLnJlbW92ZUNsYXNzKCdmaWVsZF9maWxsZWQnKTtcblx0XHR9XG5cdH1cblxuXHQkKCcuZmllbGQgaW5wdXQnKS5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdGZpbGxlZCh0aGlzKTtcblx0fSk7XG5cblx0JCgnLnRvZ2dsZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblx0XHRlLnN0b3BQcm9wYWdhdGlvbigpXG5cdFx0dmFyIGNvbnRlbnQgPSAkKHRoaXMpLnBhcmVudCgpLmZpbmQoJCgnLicrJCh0aGlzKS5kYXRhKCd0b2dnbGUnKSkpO1xuXHRcdCQodGhpcykudG9nZ2xlQ2xhc3MoJ3RvZ2dsZV9jbG9zZScpO1xuXHRcdCQoY29udGVudCkuc3RvcCgpLnNsaWRlVG9nZ2xlKDMwMCk7XG5cdH0pO1xuXG5cdCQoJy5maWx0ZXJfX2Jsb2NrLWNvbnRlbnQnKS5lYWNoKGZ1bmN0aW9uKGksIGJsb2NrKSB7XG5cdFx0dmFyIGNoZWNrcyA9ICQoYmxvY2spLmZpbmQoJy5jaGVja2JveCcpLmxlbmd0aDtcblxuXHRcdGlmIChjaGVja3MgPiA1KSB7XG5cdFx0XHQkKGJsb2NrKS5hZGRDbGFzcygnZmlsdGVyX19ibG9jay1jb250ZW50X21vcmUnKTtcblx0XHRcdCQoYmxvY2spLmFwcGVuZCgnPHNwYW4gY2xhc3M9XCJmaWx0ZXJfX2Jsb2NrLW1vcmVcIj7Qn9C+0LrQsNC30LDRgtGMINCy0YHQtTwvc3Bhbj4nKTtcblx0XHR9XG5cdH0pO1xuXG5cdCQoJy5maWx0ZXJfX2Jsb2NrLW1vcmUnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHQkKHRoaXMpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdmaWx0ZXJfX2Jsb2NrLWNvbnRlbnRfbW9yZScpO1xuXHRcdCQodGhpcykucmVtb3ZlKCk7XG5cdH0pO1xuXG5cdCQoJy5kcm9wX19pdGVtJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0aWYgKCEkKHRoaXMpLmhhc0NsYXNzKCdkcm9wX19pdGVtX2xpbmsnKSkge1xuXHRcdFx0JCh0aGlzKS5hZGRDbGFzcygnZHJvcF9faXRlbV9hY3RpdmUnKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCdkcm9wX19pdGVtX2FjdGl2ZScpO1xuXHRcdH1cblxuXHRcdCQodGhpcykuY2xvc2VzdCgnW2RhdGEtZHJvcF0nKS5yZW1vdmVDbGFzcygnZHJvcC1vcGVuJyk7XG5cdH0pO1xuXG5cdCQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdbZGF0YS1kcm9wXScsIGZ1bmN0aW9uKCkge1xuXG5cdFx0dmFyIGRhdGEgPSAkKHRoaXMpLmRhdGEoJ2Ryb3AnKTtcblxuXHRcdGlmIChkYXRhID09ICd0cmlnZ2VyJykge1xuXHRcdFx0JCgnLmRyb3Atb3BlbicpLnJlbW92ZUNsYXNzKCdkcm9wLW9wZW4nKTtcblx0XHRcdCQodGhpcykucGFyZW50KCkuY2xvc2VzdCgnW2RhdGEtZHJvcF0nKS5hZGRDbGFzcygnZHJvcC1vcGVuJyk7XG5cdFx0fSBlbHNlIHJldHVybjtcblxuXHR9KTtcblxuXHQkKGRvY3VtZW50KS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG5cblx0XHR2YXIgZHJvcCA9ICQoZS50YXJnZXQpLnBhcmVudCgpLmNsb3Nlc3QoJ1tkYXRhLWRyb3BdJykuZ2V0KDApLFxuXHRcdFx0XHR0aXAgPSAkKGUudGFyZ2V0KS5wYXJlbnQoKS5jbG9zZXN0KCcudGlwJykuZ2V0KDApO1xuXG5cdFx0aWYgKCQoZS50YXJnZXQpLmhhc0NsYXNzKCdjb3VudGVyX19idG5fcGx1cycpKSByZXR1cm47XG5cblx0XHRpZiAoIWRyb3ApIHtcblx0XHRcdCQoJy5kcm9wLW9wZW4nKS5yZW1vdmVDbGFzcygnZHJvcC1vcGVuJyk7XG5cdFx0fVxuXG5cdFx0aWYgKCF0aXApIHtcblx0XHRcdCQoJy50aXBfX2hpZGVjb250ZW50JykuaGlkZSgpO1xuXHRcdH1cblxuXHR9KVxuXG5cdCQoJy5kZXNjcmlwdGlvbl9fc2hvdycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdCQodGhpcykuaGlkZSgpO1xuXHRcdCQoJy5kZXNjcmlwdGlvbl9fc2hvcnQnKS5oaWRlKCk7XG5cdFx0JCgnLmRlc2NyaXB0aW9uX19hbGwnKS5zaG93KCk7XG5cdH0pO1xuXG5cdCQoJ1tkYXRhLWNsb3NlXScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHQkKHRoaXMpLnBhcmVudCgpLmhpZGUoKTtcblx0XHQkKHRoaXMpLmNsb3Nlc3QoJy5jYXJkJykuY3NzKCd6LWluZGV4JywgJycpO1xuXHR9KTtcblxuXHQkKCcudGlwX19uYW1lJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0JCgnLmNhcmQnKS5jc3MoJ3otaW5kZXgnLCAnJyk7XG5cdFx0JCgnLnRpcF9faGlkZWNvbnRlbnQnKS5oaWRlKCk7XG5cdFx0JCh0aGlzKS5wYXJlbnQoKS5maW5kKCcudGlwX19oaWRlY29udGVudCcpLnNob3coKTtcblx0XHQkKHRoaXMpLmNsb3Nlc3QoJy5jYXJkJykuY3NzKCd6LWluZGV4JywgJzInKTtcblx0fSk7XG5cblx0Ly8gR2FsbGVyeVxuXHQkKCcuZ2FsbGVyeV9fZWxlbWVudCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuXG5cdFx0aWYgKCQodGhpcykuaGFzQ2xhc3MoJ2dhbGxlcnlfX2VsZW1lbnRfdmlkZW8nKSkge1xuXHRcdFx0dmFyIHZpZGVvID0gJCh0aGlzKS5maW5kKCd2aWRlbycpLmNsb25lKCk7XG5cblx0XHRcdCQoJy5tb2RhbF96b29tIC5tb2RhbF9fY29udGVudCcpLmh0bWwodmlkZW8pO1xuXG5cdFx0XHQkKCcubW9kYWxfem9vbScpLml6aU1vZGFsKCdvcGVuJyk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0dmFyIGltZyA9ICQodGhpcykuZmluZCgnaW1nJykuY2xvbmUoKTtcblxuXHRcdFx0JCh0aGlzKS5jbG9zZXN0KCcuZ2FsbGVyeScpLmZpbmQoJy5nYWxsZXJ5X192aWV3JykuZW1wdHkoKS5hcHBlbmQoaW1nKTtcblxuXHRcdFx0JCh0aGlzKS5jbG9zZXN0KCcuZ2FsbGVyeV9fbGlzdCcpLmZpbmQoJy5nYWxsZXJ5X19lbGVtZW50X2FjdGl2ZScpLnJlbW92ZUNsYXNzKCdnYWxsZXJ5X19lbGVtZW50X2FjdGl2ZScpO1xuXHRcdFx0JCh0aGlzKS5hZGRDbGFzcygnZ2FsbGVyeV9fZWxlbWVudF9hY3RpdmUnKTtcblx0XHR9XG5cblx0fSk7XG5cblx0JCgnLnZsaXN0X2Z1bGwnKS5lYWNoKGZ1bmN0aW9uKGksIGxpc3QpIHtcblx0XHR2YXIgc2hvdyA9ICQobGlzdCkuZGF0YSgnc2hvdycpLFxuXHRcdFx0XHRsaW5lID0gJChsaXN0KS5maW5kKCcudmxpc3RfX2xpbmU6bm90KC52bGlzdF9fbGluZV9oZWFkKScpLmdldChzaG93KTtcblxuXHRcdCQobGluZSkuaGlkZSgpLm5leHRBbGwoJzpub3QoLnZsaXN0X19saW5lX21vcmUpJykuaGlkZSgpO1xuXHR9KTtcblxuXHQkKCcudmxpc3RfX21vcmUnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHQkKHRoaXMpLmNsb3Nlc3QoJy52bGlzdCcpLnRvZ2dsZUNsYXNzKCd2bGlzdF9hbGxzaG93Jyk7XG5cdH0pO1xuXG5cdC8vIE1vZGFsXG5cblx0c2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHQkKCdbZGF0YS1tb2RhbF0nKS5pemlNb2RhbCh7XG5cdFx0XHRvbkNsb3Npbmc6IGZ1bmN0aW9uKHIpe1xuXHRcdFx0XHR2YXIgdmlkZW8gPSByLiRlbGVtZW50LmZpbmQoJ3ZpZGVvJykuZ2V0KDApO1xuXG5cdFx0XHRcdGlmICh2aWRlbykge1xuXHRcdFx0XHRcdHZpZGVvLnBhdXNlKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0fSwgMSlcblxuXG5cdCQoJ1tkYXRhLW9wZW5dJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdHZhciBtID0gJCh0aGlzKS5kYXRhKCdvcGVuJyk7XG5cdFx0JCgnW2RhdGEtbW9kYWw9JyttKyddJykuaXppTW9kYWwoJ29wZW4nKTtcblx0fSk7XG5cblxuXHQkKCcuZ2FsbGVyeV9fdmlldycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdHZhciBpbWcgPSAkKHRoaXMpLmZpbmQoJ2ltZycpLmNsb25lKCk7XG5cblx0XHQkKCcubW9kYWxfem9vbSAubW9kYWxfX2NvbnRlbnQnKS5odG1sKGltZylcblxuXHRcdCQoJy5tb2RhbF96b29tJykuaXppTW9kYWwoJ29wZW4nKTtcblx0fSk7XG5cblxuXHQkKCcuZmlsdGVyLXRvZ2dsZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdCQoJy5maWx0ZXIgLnRvZ2dsZTpub3QoLnRvZ2dsZV9jbG9zZSknKS50cmlnZ2VyKCdjbGljaycpO1xuXHRcdCQoJy5maWx0ZXInKS50b2dnbGUoKTtcblx0fSk7XG5cblx0JCgnLm0tbWVudV9fdG9nZ2xlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0JCgnLm0tbWVudV9fY29udGVudCcpLnRvZ2dsZSgpO1xuXHR9KTtcblxuXHQkKCcubS1tZW51X19pdGVtX2Ryb3AnKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG5cdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuXHRcdHZhciBkcm9wID0gJCh0aGlzKS5maW5kKCcubS1tZW51X19kcm9wJykuZmlyc3QoKTtcblxuXG5cdFx0aWYgKCQoZS50YXJnZXQpLnBhcmVudHNVbnRpbCgnLm0tbWVudV9faXRlbV9kcm9wJykubGVuZ3RoIDw9IDEpIHtcblx0XHRcdCQoZHJvcCkudG9nZ2xlQ2xhc3MoJ20tbWVudV9fZHJvcF9zaG93Jyk7XG5cdFx0fVxuXG5cdH0pO1xuXG5cdCQoJy5tLW1lbnVfX2JhY2snKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG5cdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuXHRcdCQodGhpcykuY2xvc2VzdCgnLm0tbWVudV9fZHJvcF9zaG93JykucmVtb3ZlQ2xhc3MoJ20tbWVudV9fZHJvcF9zaG93Jyk7XG5cdH0pO1xuXG5cdCQoJ1tkYXRhLXRhYnNdID4gKicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHR2YXIgZGF0YSA9ICQodGhpcykucGFyZW50KCkuZGF0YSgndGFicycpLFxuXHRcdFx0XHRpbmRleCA9ICQodGhpcykuaW5kZXgoKSxcblx0XHRcdFx0Y29udGVudCA9ICQoJ1tkYXRhLXRhYnMtY29udGVudD0nK2RhdGErJ10nKS5jaGlsZHJlbigpLmdldChpbmRleCk7XG5cblx0XHQkKGNvbnRlbnQpLnNob3coKS5zaWJsaW5ncygpLmhpZGUoKTtcblxuXHRcdGlmICghY29udGVudCkge1xuXHRcdFx0JCgnW2RhdGEtdGFicy1jb250ZW50PScrZGF0YSsnXScpLmNoaWxkcmVuKCkuaGlkZSgpO1xuXHRcdH1cblxuXHRcdCQodGhpcykuYWRkQ2xhc3MoJ2FjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuXHR9KTtcblxuXHQvLyBpZiAoJCgnLm1vZGFsX3ZpZGVvJykuZ2V0KDApKSB7XG5cdC8vIFx0JChcIi5tb2RhbF92aWRlb1wiKS5pemlNb2RhbCh7XG5cdC8vIFx0XHRoaXN0b3J5OiBmYWxzZSxcblx0Ly8gXHRcdGlmcmFtZSA6IHRydWUsXG5cdC8vIFx0XHRmdWxsc2NyZWVuOiB0cnVlLFxuXHQvLyBcdFx0aGVhZGVyQ29sb3I6ICcjMDAwMDAwJyxcblx0Ly8gXHRcdGdyb3VwOiAnZ3JvdXAxJyxcblx0Ly8gXHRcdGxvb3A6IHRydWVcblx0Ly8gXHR9KTtcblx0Ly8gfVxuXG5cblx0JCgnLnZpZGVvJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0dmFyIGlkID0gJCh0aGlzKS5kYXRhKCdpZCcpO1xuXG5cdFx0JCgnIycraWQpLml6aU1vZGFsKCdvcGVuJyk7XG5cdH0pO1xuXG5cdCQoJy5jaGVja2JveCBpbnB1dCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG5cdFx0JCh0aGlzKS5jbG9zZXN0KCcuY2hlY2tib3gnKS50b2dnbGVDbGFzcygnY2hlY2tib3hfYWN0aXZlJyk7XG5cdH0pO1xuXG5cdHZhciBzY3JvbGxpbmcsXG5cdFx0XHR0b1RvcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50by10b3AnKTtcblxuXHRkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBmdW5jdGlvbigpIHtcblx0XHQgc2Nyb2xsaW5nID0gZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7XG5cblx0XHQgaWYgKHNjcm9sbGluZyA+PSAxMDAwICYmIHdpbmRvd1dpZHRoID4gOTYwKSB7XG5cdFx0XHQgdG9Ub3AuY2xhc3NMaXN0LmFkZCgndG8tdG9wX3Nob3cnKTtcblx0XHQgfSBlbHNlIHtcblx0XHRcdCB0b1RvcC5jbGFzc0xpc3QucmVtb3ZlKCd0by10b3Bfc2hvdycpO1xuXHRcdCB9XG5cdH0sIHRydWUpO1xuXG5cdCQoJy50by10b3AnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHQkKFwiaHRtbCwgYm9keVwiKS5zdG9wKCkuYW5pbWF0ZSh7c2Nyb2xsVG9wOjB9LCA1MDAsICdzd2luZycpO1xuXHR9KTtcblxuXHQkKCcuY291bnRlcl9fYnRuX3BsdXMnKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0JCgnLnRpcF9faGlkZWNvbnRlbnQnKS5oaWRlKCk7XG5cdFx0JCh0aGlzKS5wYXJlbnQoKS5maW5kKCcudGlwX19oaWRlY29udGVudCcpLmZpcnN0KCkuc2hvdygpO1xuXHR9KTtcblxuXHRpbml0KCk7XG5cblx0JCgnYnV0dG9uLmJ0biwgLmNvdW50ZXJfX2J0biwgLmNhcnRfX2Nsb3NlLCAuY2xvc2UnKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHR9KVxuXG5cbn0pKHdpbmRvdyk7XG4iXX0=
